<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="SmalleBlog | AEZOCN" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="代码，让生活更美化">
<meta property="og:type" content="website">
<meta property="og:title" content="SmalleBlog | AEZOCN">
<meta property="og:url" content="http://blog.aezo.cn/page/3/index.html">
<meta property="og:site_name" content="SmalleBlog | AEZOCN">
<meta property="og:description" content="代码，让生活更美化">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SmalleBlog | AEZOCN">
<meta name="twitter:description" content="代码，让生活更美化">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.aezo.cn/page/3/"/>





  <title>SmalleBlog | AEZOCN</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">SmalleBlog | AEZOCN</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Better Code,Better Life</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/31/db/2016-08-31-shading-jdbc源码解读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/31/db/2016-08-31-shading-jdbc源码解读/" itemprop="url">sharding-jdbc 源码学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-31T20:13:00+08:00">
                2016-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>文档来源：胡翔宇。此处仅作存档学习！</p>
</blockquote>
<ol>
<li><p>ShardingDataSource<br> 类图<br> <img src="http://i.imgur.com/3bajMxv.png" alt=""><br> 类解析（由父类向下）</p>
<pre><code>WrapperAdapter：Wrapper适配类主要作用是额外记录jdbc方法调用以及回放。
    /**
     * 记录方法调用.
     *
     * @param targetClass 目标类
        * @param methodName 方法名称
     * @param argumentTypes 参数类型
     * @param arguments 参数
     */
    protected final void recordMethodInvocation(final Class&lt;?&gt; targetClass, final String methodName, final Class&lt;?&gt;[] argumentTypes, final Object[] arguments) {
        try {
            jdbcMethodInvocations.add(new JdbcMethodInvocation(targetClass.getMethod(methodName, argumentTypes), arguments));
        } catch (final NoSuchMethodException ex) {
            throw new ShardingJdbcException(ex);
        }
    }

    /**
     * 回放记录的方法调用.
     *
     * @param target 目标对象
     */
    protected final void replayMethodsInvocation(final Object target) {
        for (JdbcMethodInvocation each : jdbcMethodInvocations) {
            each.invoke(target);
        }
    }

AbstractUnsupportedOperationDataSource ： 声明不支持操作的数据源对象。
AbstractDataSourceAdapter ： 适配基类没有实际的业务操作，拓展使用（如图后加入的读写分离就是最好的例子）。
</code></pre><p> ShardingDataSource ： 支持分片的数据源。</p>
<pre><code>重点内容  
ShardingProperties 变量 ： 主要是jdbc的配置
shardingContext :  数据源运行期上下文。   此处要注意的是上下文是分库分表规则的持有者，也是路由引擎，执行引擎的持有者
方法  
getDatabaseProductName ： 根据分库分表规则获取数据库类型（有主从的时候，与其他区分处理）。
getConnection()： 获取数据库连接 返回 ShardingConnection 连接。
</code></pre><p> 使用方法</p>
<pre><code> DataSourceRule dataSourceRule = new DataSourceRule(createDataSourceMap());
//order 分表
TableRule orderTableRule = TableRule.builder(&quot;t_order&quot;).actualTables(Arrays.asList(&quot;t_order_0&quot;, &quot;t_order_1&quot;)).dataSourceRule(dataSourceRule).build();
// order_iterm 分表
TableRule orderItemTableRule = TableRule.builder(&quot;t_order_item&quot;).actualTables(Arrays.asList(&quot;t_order_item_0&quot;, &quot;t_order_item_1&quot;)).dataSourceRule(dataSourceRule).build();
ShardingRule shardingRule = ShardingRule.builder().dataSourceRule(dataSourceRule).tableRules(Arrays.asList(orderTableRule, orderItemTableRule))
        .bindingTableRules(Collections.singletonList(new BindingTableRule(Arrays.asList(orderTableRule, orderItemTableRule))))
        .databaseShardingStrategy(new DatabaseShardingStrategy(&quot;user_id&quot;, new ModuloDatabaseShardingAlgorithm()))
        .tableShardingStrategy(new TableShardingStrategy(&quot;order_id&quot;, new ModuloTableShardingAlgorithm())).build();
//同时会new 一个 ShardingProperties初始化
return new ShardingDataSource(shardingRule);

//设置分库 ds_0,ds_1
 private static Map&lt;String, DataSource&gt; createDataSourceMap() {
    Map&lt;String, DataSource&gt; result = new HashMap&lt;&gt;(2);
    result.put(&quot;ds_0&quot;, createDataSource(&quot;ds_0&quot;));
    result.put(&quot;ds_1&quot;, createDataSource(&quot;ds_1&quot;));
    return result;
}
</code></pre></li>
<li><p>ShardingConnection<br>类图<br><img src="http://i.imgur.com/KFTd9ZT.png" alt=""><br>类解析（由父类向下）</p>
<pre><code> AbstractUnsupportedOperationConnection： 声明不支持操作的数据库连接对象.主要就是自定义不支持异常抛出
AbstractConnectionAdapter :  数据库连接适配器，公共方法（可拓展）。
    setAutoCommit（） ： 设置分库分表自动提交。
    commit（）： 提交操作
    rollback（） ： 回滚

ShardingConnection ： 分库分表connection
    connectionMap 变量 connection的持有者（一个库对应一个connection）
    shardingContext : 略
    getConnectionInternal（）：getConnection（）实际调用该方法。
         private Connection getConnectionInternal(final String dataSourceName, final SQLStatementType sqlStatementType) throws SQLException {
            //已经生成的connection直接返回
            if (connectionMap.containsKey(dataSourceName)) {
                return connectionMap.get(dataSourceName);
            }
            //用到 guava [http://ifeve.com/google-guava/](http://ifeve.com/google-guava/ &quot;guava&quot;),计时
            Context metricsContext = MetricsContext.start(Joiner.on(&quot;-&quot;).join(&quot;ShardingConnection-getConnection&quot;, dataSourceName));
            DataSource dataSource = shardingContext.getShardingRule().getDataSourceRule().getDataSource(dataSourceName);
            if (dataSource instanceof MasterSlaveDataSource) {
                dataSource = ((MasterSlaveDataSource) dataSource).getDataSource(sqlStatementType);
            }
            Connection result = dataSource.getConnection();
            MetricsContext.stop(metricsContext);
            connectionMap.put(dataSourceName, result);
            return result;
        }

    close（）： 连接关闭
         @Override
        public void close() throws SQLException {
            super.close();
            //清理线索分片管理器的本地线程持有者.（此处是一个问题，接下来要仔细分析一下）
            HintManagerHolder.clear();
            //此处是个问题
            MasterSlaveDataSource.resetDMLFlag();
        }
</code></pre><p>使用</p>
<pre><code>Connection conn = dataSource.getConnection();
</code></pre></li>
<li><p>ShardingStatement ： 支持分片的静态语句对象（不支持存储过程）.<br> 类图<br> <img src="http://i.imgur.com/Gd6DBKS.png" alt=""><br>  类解析（由父类向下）</p>
<pre><code>AbstractStatementAdapter：静态语句对象适配类.
    closed : 关闭标识
    poolable ： 暂未看
    fetchSize ： 条数
    //获取更新条数
     @Override
    public final int getUpdateCount() throws SQLException {
        int result = 0;
        for (Statement each : getRoutedStatements()) {
            result += each.getUpdateCount();
        }
        return result;
    }
    其他方法略

    ShardingStatement ： 支持分片的静态语句对象.
        shardingConnection：
        resultSetType：
        resultSetConcurrency ：
        resultSetHoldability：
        cachedRoutedStatements ： statemnets持有者
        mergeContext ： 结果归并上下文.
         currentResultSet ：
        //执行查询
         @Override
        public ResultSet executeQuery(final String sql) throws SQLException {
            if (null != currentResultSet &amp;&amp; !currentResultSet.isClosed()) {
                currentResultSet.close();
            }
            //先生成执行器，然后执行查询（归并mergeContext页作为参数传过去以便最后归并），整个过程下面会详细说
            currentResultSet = ResultSetFactory.getResultSet(generateExecutor(sql).executeQuery(), mergeContext);
            return currentResultSet;
        }

        private StatementExecutor generateExecutor(final String sql) throws SQLException {
            StatementExecutor result = new StatementExecutor(shardingConnection.getShardingContext().getExecutorEngine());
            //路由sql 下面详细讲解
            SQLRouteResult sqlRouteResult = shardingConnection.getShardingContext().getSqlRouteEngine().route(sql);
            mergeContext = sqlRouteResult.getMergeContext();
            //将路由结果放置到执行器中，以便后面执行（
            for (SQLExecutionUnit each : sqlRouteResult.getExecutionUnits()) {
                Statement statement = getStatement(shardingConnection.getConnection(each.getDataSource(), sqlRouteResult.getSqlStatementType()), each.getSql());
                replayMethodsInvocation(statement);
                //StatementExecutorWrapper 执行单位，和 statement组合放入执行器中
                result.addStatement(new StatementExecutorWrapper(statement, each));
            }
            return result;
        }
</code></pre></li>
</ol>
<ol>
<li>ShardingPreparedStatement ：  支持分片的预编译语句对象.</li>
<li>解析</li>
<li><p>路由<br> 类图<br> <img src="http://i.imgur.com/xeGFWga.png" alt=""></p>
<pre><code> /**
 * SQL路由.非预编译
 *
 * @param logicSql 逻辑SQL
 * @return 路由结果
 * @throws SQLParserException SQL解析失败异常
 */
public SQLRouteResult route(final String logicSql) throws SQLParserException {
    return route(logicSql, Collections.emptyList());
}
/**
 * SQL路由.
 *
 * @param logicSql 逻辑SQL
 * @param parameters 参数列表
 * @return 路由结果
 * @throws SQLParserException SQL解析失败异常
 */
public SQLRouteResult route(final String logicSql, final List&lt;Object&gt; parameters) throws SQLParserException {
    //先执行一遍，解析（接下载解析模块说明），解析的时候会设置SqlStatementType
    return routeSQL(parseSQL(logicSql, parameters), parameters);
}
 SQLRouteResult routeSQL(final SQLParsedResult parsedResult, final List&lt;Object&gt; parameters) {
    //计时
    Context context = MetricsContext.start(&quot;Route SQL&quot;);
    SQLRouteResult result = new SQLRouteResult(parsedResult.getRouteContext().getSqlStatementType(), parsedResult.getMergeContext());
    //遍历解析结果
    for (ConditionContext each : parsedResult.getConditionContexts()) {
        //将实际路由的   执行单元加入路由结果中
        result.getExecutionUnits().addAll(routeSQL(each, Sets.newLinkedHashSet(Collections2.transform(parsedResult.getRouteContext().getTables(), new Function&lt;Table, String&gt;() {

            @Override
            public String apply(final Table input) {
                return input.getName();
            }
        })), parsedResult.getRouteContext().getSqlBuilder(), parsedResult.getRouteContext().getSqlStatementType()));
    }
    //判断是否有限定结果集计算.
    processLimit(result.getExecutionUnits(), parsedResult, parameters);
    //计时
    MetricsContext.stop(context);
    log.debug(&quot;final route result:{}&quot;, result.getExecutionUnits());
    log.debug(&quot;merge context:{}&quot;, result.getMergeContext());
    return result;
}

SQLParsedResult parseSQL(final String logicSql, final List&lt;Object&gt; parameters) {
        Context context = MetricsContext.start(&quot;Parse SQL&quot;);
        SQLParsedResult result = SQLParserFactory.create(databaseType, logicSql, parameters, shardingRule.getAllShardingColumns()).parse();
        MetricsContext.stop(context);
        return result;
    }

private Collection&lt;SQLExecutionUnit&gt; routeSQL(final ConditionContext conditionContext, final Set&lt;String&gt;     logicTables, final SQLBuilder sqlBuilder, final SQLStatementType type) {
    RoutingResult result;
    //判断逻辑表数量，就是看看是否是单表操作
    if (1 == logicTables.size()) {
        result = new SingleTableRouter(shardingRule, logicTables.iterator().next(), conditionContext, type).route();
    }
    //判断逻辑表名称集合是否全部属于Binding表.(绑定表代表一组表，这组表的逻辑表与实际表之间的映射关系是相同的。比如t_order与t_order_item就是这样一组绑定表关系,它们的分库与分表策略是完全相同的,那么可以使用它们的表规则将它们配置成绑定表)
    else if (shardingRule.isAllBindingTables(logicTables)) {
        result = new BindingTablesRouter(shardingRule, logicTables, conditionContext, type).route();
    } else {
        // TODO 可配置是否执行笛卡尔积
        result = new MixedTablesRouter(shardingRule, logicTables, conditionContext, type).route();
    }
    if (null == result) {
        throw new ShardingJdbcException(&quot;Sharding-JDBC: cannot route any result, please check your sharding rule.&quot;);
    }
    return result.getSQLExecutionUnits(sqlBuilder);
}

单表路由
/**
 * 路由.
 *
 * @return 路由结果
 */
public SingleRoutingResult route() {
    //多库则返回多个库名称
    Collection&lt;String&gt; routedDataSources = routeDataSources();
    Collection&lt;String&gt; routedTables = routeTables(routedDataSources);
    return generateRoutingResult(routedDataSources, routedTables);
}

//路由数据库
private Collection&lt;String&gt; routeDataSources() {
    DatabaseShardingStrategy strategy = shardingRule.getDatabaseShardingStrategy(tableRule);
    List&lt;ShardingValue&lt;?&gt;&gt; shardingValues;
    if (HintManagerHolder.isUseShardingHint()) {
        shardingValues = getDatabaseShardingValuesFromHint(strategy.getShardingColumns());
    } else {
        //[ShardingValue(logicTableName=t_order, columnName=user_id, value=10, values=[], valueRange=null)]
        //* @param logicTable 逻辑表名称 * @param shardingColumn 分片键  * @param value 分片值
        shardingValues = getShardingValues(strategy.getShardingColumns());
    }
    logBeforeRoute(&quot;database&quot;, logicTable, tableRule.getActualDatasourceNames(), strategy.getShardingColumns(), shardingValues);
    Collection&lt;String&gt; result = new HashSet&lt;&gt;(strategy.doStaticSharding(sqlStatementType, tableRule.getActualDatasourceNames(), shardingValues));
    logAfterRoute(&quot;database&quot;, logicTable, result);
    Preconditions.checkState(!result.isEmpty(), &quot;no database route info&quot;);
    return result;
}
 /**
 * 计算静态分片.
 *
 * @param sqlStatementType SQL语句的类型
 * @param availableTargetNames 所有的可用分片资源集合
 * @param shardingValues 分片值集合
 * @return 分库后指向的数据源名称集合
 */
public Collection&lt;String&gt; doStaticSharding(final SQLStatementType sqlStatementType, final Collection&lt;String&gt; availableTargetNames, final Collection&lt;ShardingValue&lt;?&gt;&gt; shardingValues) {
    if (shardingValues.isEmpty()) {
        Preconditions.checkState(!isInsertMultiple(sqlStatementType, availableTargetNames), &quot;INSERT statement should contain sharding value.&quot;);
        return availableTargetNames;
    }
    //分片算法是这边调用的，返回路由结果（实际表，实际数据库）
    return doSharding(shardingValues, availableTargetNames);
}
//路由实际表
 private Collection&lt;String&gt; routeTables(final Collection&lt;String&gt; routedDataSources) {
    TableShardingStrategy strategy = shardingRule.getTableShardingStrategy(tableRule);
    List&lt;ShardingValue&lt;?&gt;&gt; shardingValues;
    if (HintManagerHolder.isUseShardingHint()) {
        shardingValues = getTableShardingValuesFromHint(strategy.getShardingColumns());
    } else {
        shardingValues = getShardingValues(strategy.getShardingColumns());
    }
    logBeforeRoute(&quot;table&quot;, logicTable, tableRule.getActualTables(), strategy.getShardingColumns(), shardingValues);
    Collection&lt;String&gt; result;
    if (tableRule.isDynamic()) {
        result = new HashSet&lt;&gt;(strategy.doDynamicSharding(shardingValues));
    } else {
        result = new HashSet&lt;&gt;(strategy.doStaticSharding(sqlStatementType, tableRule.getActualTableNames(routedDataSources), shardingValues));    
    }
    logAfterRoute(&quot;table&quot;, logicTable, result);
    Preconditions.checkState(!result.isEmpty(), &quot;no table route info&quot;);
    return result;
}

private SingleRoutingResult generateRoutingResult(final Collection&lt;String&gt; routedDataSources, final             Collection&lt;String&gt; routedTables) {
    SingleRoutingResult result = new SingleRoutingResult();
    //[DataNode(dataSourceName=ds_0, tableName=t_order_1), DataNode(dataSourceName=ds_1, tableName=t_order_1), DataNode(dataSourceName=ds_0, tableName=t_order_0), DataNode(dataSourceName=ds_1, tableName=t_order_0)]（第一次生成4个）
    //该方法会调用多次
    for (DataNode each : tableRule.getActualDataNodes(routedDataSources, routedTables)) {
        result.put(each.getDataSourceName(), new SingleRoutingTableFactor(logicTable, each.getTableName()));
    }
    return result;
}
</code></pre></li>
<li><p>执行<br> 类图<br> <img src="http://i.imgur.com/b1XLRum.png" alt=""></p>
<pre><code>首先executeQuery 由 ShardingStatement（ShardingPreparedStatement）调用
 @Override
public ResultSet executeQuery(final String sql) throws SQLException {
    if (null != currentResultSet &amp;&amp; !currentResultSet.isClosed()) {
        currentResultSet.close();
    }
    currentResultSet = ResultSetFactory.getResultSet(generateExecutor(sql).executeQuery(), mergeContext);
    return currentResultSet;
}

private StatementExecutor generateExecutor(final String sql) throws SQLException {
    StatementExecutor result = new StatementExecutor(shardingConnection.getShardingContext().getExecutorEngine());
    //路由sql
    SQLRouteResult sqlRouteResult = shardingConnection.getShardingContext().getSqlRouteEngine().route(sql);
    mergeContext = sqlRouteResult.getMergeContext();
    for (SQLExecutionUnit each : sqlRouteResult.getExecutionUnits()) {
        Statement statement = getStatement(shardingConnection.getConnection(each.getDataSource(), sqlRouteResult.getSqlStatementType()), each.getSql());
        replayMethodsInvocation(statement);
        //SQLExecutionUnit，statement 组装成发给StatementExecutorWrapper 给执行器执行
        result.addStatement(new StatementExecutorWrapper(statement, each));
    }
    return result;
}

可以看出 generateExecutor 方法生成 StatementExecutor 执行器 接着调用 executeQuery
 /**
 * 执行SQL查询.
 *
 * @return 结果集列表
 */
public List&lt;ResultSet&gt; executeQuery() {
    //计时
    Context context = MetricsContext.start(&quot;ShardingStatement-executeQuery&quot;);
    postExecutionEvents();//（此处是一个问题，接下来要仔细分析一下）
    final boolean isExceptionThrown = ExecutorExceptionHandler.isExceptionThrown();
    final Map&lt;String, Object&gt; dataMap = ExecutorDataMap.getDataMap();
    List&lt;ResultSet&gt; result;
    try {
        if (1 == statementExecutorWrappers.size()) {
            return Collections.singletonList(executeQueryInternal(statementExecutorWrappers.iterator().next(), isExceptionThrown, dataMap));
        }
        result = executorEngine.execute(statementExecutorWrappers, new ExecuteUnit&lt;StatementExecutorWrapper, ResultSet&gt;() {

            @Override
            public ResultSet execute(final StatementExecutorWrapper input) throws Exception {
                return executeQueryInternal(input, isExceptionThrown, dataMap);
            }
        });
    } finally {
        MetricsContext.stop(context);
    }
    return result;
}

/**
 * 多线程执行任务.（运用谷歌com.google.common.util.concurrent）
 *
 * @param inputs 输入参数
 * @param executeUnit 执行单元
 * @param &lt;I&gt; 入参类型
 * @param &lt;O&gt; 出参类型
 * @return 执行结果
 */
public &lt;I, O&gt; List&lt;O&gt; execute(final Collection&lt;I&gt; inputs, final ExecuteUnit&lt;I, O&gt; executeUnit) {
    ListenableFuture&lt;List&lt;O&gt;&gt; futures = submitFutures(inputs, executeUnit);
    addCallback(futures);
    return getFutureResults(futures);
}

private ResultSet executeQueryInternal(final StatementExecutorWrapper statementExecutorWrapper, final boolean isExceptionThrown, final Map&lt;String, Object&gt; dataMap) {
    ResultSet result;
    ExecutorExceptionHandler.setExceptionThrown(isExceptionThrown);
    ExecutorDataMap.setDataMap(dataMap);
    try {
        //statementExecutorWrapper.getSqlExecutionUnit().getSql() 要参考 SqlExecutionUnit 里面的 sql参数生成过程
        result = statementExecutorWrapper.getStatement().executeQuery(statementExecutorWrapper.getSqlExecutionUnit().getSql());
    } catch (final SQLException ex) {
        postExecutionEventsAfterExecution(statementExecutorWrapper, EventExecutionType.EXECUTE_FAILURE, Optional.of(ex));
        ExecutorExceptionHandler.handleException(ex);
        return null;
    }
    postExecutionEventsAfterExecution(statementExecutorWrapper);
    return result;
}
</code></pre></li>
<li><p>归并<br> 类图<br> <img src="http://i.imgur.com/czM6sto.png" alt=""></p>
<pre><code>ResultSetFactory ： 分片结果集归并工厂.
 /**
 * 获取结果集.
 *
 * @param resultSets 结果集列表
 * @param mergeContext 结果归并上下文
 * @return 结果集包装
 */
public static ResultSet getResultSet(final List&lt;ResultSet&gt; resultSets, final MergeContext mergeContext) throws SQLException {
    ShardingResultSets shardingResultSets = new ShardingResultSets(resultSets);
    log.trace(&quot;Sharding-JDBC: Sharding result sets type is &apos;{}&apos;&quot;, shardingResultSets.getType().toString());
    switch (shardingResultSets.getType()) {
        case EMPTY:
            return buildEmpty(resultSets);
        case SINGLE:
            return buildSingle(shardingResultSets, mergeContext);
        case MULTIPLE:
            return buildMultiple(shardingResultSets, mergeContext);
        default:
            throw new UnsupportedOperationException(shardingResultSets.getType().toString());
    }
}
//直接看buildMultiple 上面比较简单直接返回即可
private static ResultSet buildMultiple(final ShardingResultSets shardingResultSets, final MergeContext mergeContext) throws SQLException {
    //实例化 ResultSetMergeContext
    ResultSetMergeContext resultSetMergeContext = new ResultSetMergeContext(shardingResultSets, mergeContext);
    return buildCoupling(buildReducer(resultSetMergeContext), resultSetMergeContext);
  }
public ResultSetMergeContext(final ShardingResultSets shardingResultSets, final MergeContext mergeContext) throws SQLException {
    this.shardingResultSets = shardingResultSets;
    this.mergeContext = mergeContext;
    currentOrderByKeys = new LinkedList&lt;&gt;();
    init();
}

private void init() throws SQLException {
    //初始化 AbstractResultSetAdapter 一个实例  看下 AbstractResultSetAdapter 初始化干了什么
    setColumnIndex(((AbstractResultSetAdapter) shardingResultSets.getResultSets().get(0)).getColumnLabelIndexMap());
    currentOrderByKeys.addAll(mergeContext.getOrderByColumns());
}

private void setColumnIndex(final Map&lt;String, Integer&gt; columnLabelIndexMap) {
    for (IndexColumn each : getAllFocusedColumns()) {
        if (each.getColumnIndex() &gt; 0) {
            continue;
        }
        Preconditions.checkState(
                columnLabelIndexMap.containsKey(each.getColumnLabel().orNull()) || columnLabelIndexMap.containsKey(each.getColumnName().orNull()), String.format(&quot;%s has not index&quot;, each));
        if (each.getColumnLabel().isPresent() &amp;&amp; columnLabelIndexMap.containsKey(each.getColumnLabel().get())) {
            each.setColumnIndex(columnLabelIndexMap.get(each.getColumnLabel().get()));
        } else if (each.getColumnName().isPresent() &amp;&amp; columnLabelIndexMap.containsKey(each.getColumnName().get())) {
            each.setColumnIndex(columnLabelIndexMap.get(each.getColumnName().get()));
        }
    }
}
</code></pre></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/31/db/2016-08-31-shading-jdbc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/31/db/2016-08-31-shading-jdbc/" itemprop="url">shading-jdbc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-31T19:13:00+08:00">
                2016-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Shading介绍"><a href="#Shading介绍" class="headerlink" title="Shading介绍"></a>Shading介绍</h2><table>
<thead>
<tr>
<th>功能</th>
<th>Cobar</th>
<th>Mycat</th>
<th>Heisenberg</th>
<th>TDDL</th>
<th>Sharding-JDBC</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否开源</td>
<td>开源</td>
<td>开源</td>
<td>开源</td>
<td>部分开源</td>
<td>开源</td>
</tr>
<tr>
<td>架构模型</td>
<td>Proxy架构</td>
<td>Proxy架构</td>
<td>Proxy架构</td>
<td>应用集成架构</td>
<td>应用集成架构</td>
</tr>
<tr>
<td>数据库支持</td>
<td>MySQL</td>
<td>任意</td>
<td>任意</td>
<td>任意</td>
<td>MySQL(计划Oracle)</td>
</tr>
<tr>
<td>外围依赖</td>
<td>无</td>
<td>无</td>
<td>无</td>
<td>Diamond</td>
<td>无</td>
</tr>
<tr>
<td>使用复杂度</td>
<td>一般</td>
<td>一般</td>
<td>一般</td>
<td>复杂</td>
<td>一般</td>
</tr>
<tr>
<td>技术文档支持</td>
<td>较少</td>
<td>付费</td>
<td>较少</td>
<td>无</td>
<td>一般</td>
</tr>
<tr>
<td>开源组织</td>
<td>阿里</td>
<td>社区(Cobar衍生)</td>
<td>社区(Cobar衍生)</td>
<td>阿里</td>
<td>当当</td>
</tr>
</tbody>
</table>
<ol>
<li>其中TDDL是文档较少，github上代码还是4年前更新。现在TDDL已经在阿里云上架，名为DRDS(Distribute Relational Database Service 分布式关系型数据库服务)</li>
<li>基于Proxy的架构的缺点：网络消耗会产生性能问题，并且多一个外围系统依赖就意味着需要多增加和承担一份风险</li>
</ol>
<h2 id="Shading-JDBC简介"><a href="#Shading-JDBC简介" class="headerlink" title="Shading-JDBC简介"></a>Shading-JDBC简介</h2><ul>
<li>Sharding-JDBC是当当开源的数据库分库分表中间件。Sharding-JDBC直接封装JDBC协议，可以理解为增强版的JDBC驱动，旧代码迁移成本几乎为零。Sharding-JDBC定位为轻量级java框架，使用客户端直连数据库，以jar包形式提供服务，无proxy代理层，无需额外部署，无其他依赖，DBA也无需改变原有的运维方式。</li>
<li>主要特点<ul>
<li>可适用于任何基于java的ORM框架，如：JPA, Hibernate, Mybatis, Spring JDBC Template或直接使用JDBC。</li>
<li>理论上可支持任意实现JDBC规范的数据库。虽然目前仅支持MySQL，但已有支持Oracle，SQLServer，DB2等数据库的计划。</li>
<li>分片策略灵活，可支持=，BETWEEN，IN等多维度分片，也可支持多分片键共用。</li>
<li>SQL解析功能完善，支持聚合，分组，排序，Limit，OR等查询，并且支持Binding Table以及笛卡尔积的表查询。</li>
<li>支持柔性事务(目前仅完成最大努力送达型)。支持读写分离。</li>
<li>性能高。单库查询QPS为原生JDBC的99.8%；双库查询QPS比单库增加94%。</li>
</ul>
</li>
<li><a href="https://github.com/dangdangdotcom/Sharding-JDBC/" target="_blank" rel="external">GitHub源码</a> 、 <a href="http://dangdangdotcom.github.io/sharding-jdbc/" target="_blank" rel="external">官方文档</a></li>
</ul>
<h2 id="整体架构图"><a href="#整体架构图" class="headerlink" title="整体架构图"></a>整体架构图</h2><p><img src="/data/images/2016/08/shading-jdbc-architecture.png" alt="shading-jdbc架构图"></p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><h3 id="逻辑表与实际表映射关系"><a href="#逻辑表与实际表映射关系" class="headerlink" title="逻辑表与实际表映射关系"></a>逻辑表与实际表映射关系</h3><p>配置分库分表的目的是将原有一张表的数据分散到不同库不同表中，且不改变原有SQL语句的情况下来使用这一张表。那么从一张表到多张的映射关系需要使用逻辑表与实际表这两种概念。下面通过一个例子来解释一下。假设在使用PreparedStatement访问数据库，SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_order <span class="keyword">where</span> user_id = ? <span class="keyword">and</span> order_id = ?;</div></pre></td></tr></table></figure>
<p>当<code>user_id=0</code>且<code>order_id=0</code>时，Sharding-JDBC将会将SQL语句转换为如下形式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> db0.t_order_0 <span class="keyword">where</span> user_id = ? <span class="keyword">and</span> order_id = ?;</div></pre></td></tr></table></figure>
<p>其中原始SQL中的t_order就是逻辑表，而转换后的db0.t_order_0就是实际表。</p>
<p>那么，为什么当<code>user_id=0</code>且<code>order_id=0</code>时会进行这样的转换，如果当<code>user_id=1</code>且<code>order_id=1</code>时又会是什么情况？<code>user_id</code>和<code>order_id</code>这两个字段有什么特殊含义吗？</p>
<h3 id="分片键"><a href="#分片键" class="headerlink" title="分片键"></a>分片键</h3><p>官方解释：分片键是分片策略的第一个参数。分片键表示的是SQL语句中WHERE中的条件列。</p>
<p>方言：分片键就是逻辑sql语句中的某个字段，通过某个字段(或者某几个字段)可以将逻辑sql语句转换成实际运行的sql语句。上例中的<code>user_id</code>和<code>order_id</code>就是分片键。</p>
<h3 id="分片策略和分片算法"><a href="#分片策略和分片算法" class="headerlink" title="分片策略和分片算法"></a>分片策略和分片算法</h3><p>我将上面的分片键定义一个算法(如<code>user_id</code>对2取余<code>user_id % 2</code>的结果就是实际表的尾数，当然可以自己定义更复杂的算法)，对数据库或者表加上了如上的分片算法就属于分片策略。</p>
<h2 id="柔性事物"><a href="#柔性事物" class="headerlink" title="柔性事物"></a>柔性事物</h2><ul>
<li>柔性事务（遵循BASE理论）是指相对于ACID刚性事务而言的。柔性事务分为：两阶段型、补偿型、异步确保型、最大努力通知型几种。</li>
</ul>
<h2 id="其他-略"><a href="#其他-略" class="headerlink" title="其他(略)"></a>其他(略)</h2><ul>
<li><p><code>CAP</code>理论、<code>ACID</code>、<code>BASE</code></p>
<ul>
<li><p><code>CAP</code>理论</p>
<p>Web服务无法同时满足以下3个属性</p>
<ul>
<li>Consistency(一致性)，数据一致更新，所有数据变动都是同步的</li>
<li>Availability(可用性)，每个操作都必须以可预期的响应结束</li>
<li>Partition tolerance(分区容错性)，即使出现单个组件无法可用,操作依然可以完成</li>
</ul>
<p>在任何数据库设计中,一个Web应用至多只能同时支持上面的两个属性，不可能三者兼顾。对于分布式系统来说，分区容错是基本要求，所以必然要放弃一致性。对于大型网站来说， 分区容错和可用性的要求更高，所以一般都会选择适当放弃一致性。对应CAP理论，NoSQL追求的是AP，而传统数据库追求的是CA，这也可以解释为什么 传统数据库的扩展能力有限的原因。</p>
</li>
<li><p><code>ACID</code>解决方案</p>
<p>ACID数据库事务极大地简化了应用开发人员的工作.正如其缩写标识所示,ACID事务提供以下几种保证:</p>
<ul>
<li>Atomicity（原子性），事务中的所有操作,要么全部成功,要么全部不做.</li>
<li>Consistency（一致性）在事务开始与结束时,数据库处于一致状态.</li>
<li>Isolation（隔离性） 事务如同只有这一个操作在被数据库所执行一样.</li>
<li>Durability（持久性）. 在事务结束时,此操作将不可逆转.(也就是只要事务提交,系统将保证数据不会丢失,即使出现系统Crash,译者补充).</li>
</ul>
<p>数据库厂商在很久以前就认识到数据库分区的必要性,并引入了一种称为2PC(两阶段提交)的技术来提供跨越多个数据库实例的ACID保证</p>
</li>
<li><p><code>BASE</code>解决方案</p>
<ul>
<li>Basically Available（基本可用）</li>
<li>Soft-state（ 软状态/柔性事务）</li>
<li>Eventual Consistency（最终一致性）</li>
</ul>
<p>BASE模型是传统ACID模型的反面，不同与ACID，BASE强调牺牲高一致性，从而获得可用性，数据允许在一段时间内的不一致，只要保证最终一致就可以了。</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>参考文章</p>
<ul>
<li><p>[sharding-jdbc Wiki] <a href="http://dangdangdotcom.github.io/sharding-jdbc/" target="_blank" rel="external">http://dangdangdotcom.github.io/sharding-jdbc/</a></p>
</li>
<li><p>[柔性事物] <a href="http://www.zhihu.com/question/31813039/answer/53437637" target="_blank" rel="external">http://www.zhihu.com/question/31813039/answer/53437637</a></p>
</li>
<li><p>[CAP理论、ACID和BASE] <a href="http://blog.itpub.net/58054/viewspace-660826/" target="_blank" rel="external">http://blog.itpub.net/58054/viewspace-660826/</a></p>
</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/31/java/ofbiz/2016-08-31-ofbiz-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/31/java/ofbiz/2016-08-31-ofbiz-test/" itemprop="url">ofbiz单元测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-31T19:07:00+08:00">
                2016-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="测试方法书写"><a href="#测试方法书写" class="headerlink" title="测试方法书写"></a>测试方法书写</h2><ul>
<li>在ofbiz-component.xml中加入<test-suite loader="main" location="testdef/AezoTests.xml">运行测试方法的入口文件</test-suite></li>
<li><p>在入口文件AezoTests.xml中加入一个测试案例smPerson-tests</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">test-suite</span> <span class="attr">suite-name</span>=<span class="string">"Aezotests"</span></span></div><div class="line">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">  <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ofbiz.apache.org/dtds/test-suite.xsd"</span>&gt;</div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- 测试用例1：测试方法使用minilang实现 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">test-case</span> <span class="attr">case-name</span>=<span class="string">"smPerson-tests"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">simple-method-test</span> <span class="attr">name</span>=<span class="string">"smPersonTests"</span> <span class="attr">location</span>=<span class="string">"component://aezo/script/cn/aezo/test/AezoTestMethod.xml"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">test-case</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">test-suite</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>smPersonTests测试方法的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">simple-methods</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">        <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ofbiz.apache.org/dtds/simple-methods-v2.xsd"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">simple-method</span>  <span class="attr">method-name</span>=<span class="string">"smPersonTests"</span> <span class="attr">short-description</span>=<span class="string">"测试smPerson新增改查"</span> <span class="attr">login-required</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">entity-one</span> <span class="attr">entity-name</span>=<span class="string">"UserLogin"</span> <span class="attr">value-field</span>=<span class="string">"userLogin"</span> <span class="attr">auto-field-map</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">field-map</span> <span class="attr">field-name</span>=<span class="string">"userLoginId"</span> <span class="attr">value</span>=<span class="string">"system"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">entity-one</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">field</span>=<span class="string">"createSmPersonCtx.userLogin"</span> <span class="attr">from-field</span>=<span class="string">"userLogin"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">field</span>=<span class="string">"createSmPersonCtx.username"</span> <span class="attr">value</span>=<span class="string">"smalleTest"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">field</span>=<span class="string">"createSmPersonCtx.password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">field</span>=<span class="string">"createSmPersonCtx.description"</span> <span class="attr">value</span>=<span class="string">"这是实现OFBiz的Test功能产生的记录!"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">call-service</span> <span class="attr">service-name</span>=<span class="string">"createSmPersonOfTest"</span> <span class="attr">in-map-name</span>=<span class="string">"createSmPersonCtx"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">result-to-field</span> <span class="attr">result-name</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">call-service</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">log</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">message</span>=<span class="string">"========  新增SmPerson记录 [$&#123;id&#125;] ======="</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">entity-one</span> <span class="attr">entity-name</span>=<span class="string">"SmPerson"</span> <span class="attr">value-field</span>=<span class="string">"smPersonList"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">assert</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">not</span>&gt;</span><span class="tag">&lt;<span class="name">if-empty</span> <span class="attr">field</span>=<span class="string">"smPersonList"</span>/&gt;</span><span class="tag">&lt;/<span class="name">not</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">if-compare-field</span> <span class="attr">field</span>=<span class="string">"smPersonList.id"</span> <span class="attr">to-field</span>=<span class="string">"id"</span> <span class="attr">operator</span>=<span class="string">"equals"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">assert</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">check-errors</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">simple-method</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">simple-methods</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>测试方法中调用的是我们需要进行测试的功能createSmPersonOfTest(实际开发中的某个功能)</p>
</li>
</ul>
<h2 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h2><ul>
<li>如果framework/entity/config/entityengine.xml中的<code>&lt;delegator name=&quot;test&quot; ...</code>使用的数据源和默认的delegator（<code>&lt;delegator name=&quot;default&quot; ...</code>）使用的数据源（datasource）一样，则需要先运行ant的<code>load-demo</code></li>
<li>找到ant命令的<code>run-test</code>，右键<code>Run As</code>，选择<code>Ant Build...</code>。其他几个test相关的ant命令<ul>
<li><code>run-test-debug</code> 开启test时的debug。先运行此命令建立端口监听，再运行debug中该项目的远程调试命令</li>
<li><code>run-test-list</code> 运行一系列test-cast（需在runtime/test-list-build.xml中配置）</li>
<li><code>run-test-suite</code> 运行一个test-suite，如上面的suite-name=”Aezotests”，需要配置参数<code>-Dtest.suiteName=Aezotests</code></li>
<li><code>run-tests</code> 运行所有的test-cast，包括ofbiz自带的application，耗时较长</li>
</ul>
</li>
<li><p>如果选择<code>run-test</code>，则在配置<code>Main</code>选项卡中的<code>Arguments</code>，内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-Dtest.component=aezo</div><div class="line">-Dtest.case=smPerson-tests</div></pre></td></tr></table></figure>
</li>
<li><p>点击<code>Apply</code>，<code>Run</code>运行测试</p>
</li>
</ul>
<h2 id="测试结果分析"><a href="#测试结果分析" class="headerlink" title="测试结果分析"></a>测试结果分析</h2><p>测试结果会在控制台和<code>runtime/logs/test-results</code>中进行显示</p>
<h2 id="使用java方法写测试方法，并加载默认数据"><a href="#使用java方法写测试方法，并加载默认数据" class="headerlink" title="使用java方法写测试方法，并加载默认数据"></a>使用java方法写测试方法，并加载默认数据</h2><ul>
<li><p>在入口文件AezoTests.xml中加入一个测试案例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">test-suite</span> <span class="attr">suite-name</span>=<span class="string">"Aezotests"</span></span></div><div class="line">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">  <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ofbiz.apache.org/dtds/test-suite.xsd"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">test-group</span> <span class="attr">case-name</span>=<span class="string">"smPersonTest"</span>&gt;</span></div><div class="line">  	<span class="comment">&lt;!-- 加载测试需要的数据到数据库 --&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">entity-xml</span> <span class="attr">action</span>=<span class="string">"load"</span> <span class="attr">entity-xml-url</span>=<span class="string">"component://aezo/testdef/data/SmPersonTestData.xml"</span>/&gt;</span></div><div class="line">  	<span class="comment">&lt;!-- 测试方法使用java实现 --&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">junit-test-suite</span> <span class="attr">class-name</span>=<span class="string">"cn.aezo.mytest.SmPersonTest"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">test-group</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">test-suite</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>SmPersonTestData.xml的数据为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">entity-engine-xml</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">SmPerson</span> <span class="attr">username</span>=<span class="string">"smalleTestJava"</span> <span class="attr">password</span>=<span class="string">"123456"</span> <span class="attr">description</span>=<span class="string">"这是ofbiz test测试需要提前放到数据库的数据"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">entity-engine-xml</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>SmPersonTest.java中的测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.aezo.mytest; <span class="comment">// 包名最好不要起名为test，可能生成jar包失败</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> org.ofbiz.base.util.UtilMisc;</div><div class="line"><span class="keyword">import</span> org.ofbiz.entity.GenericValue;</div><div class="line"><span class="keyword">import</span> org.ofbiz.service.testtools.OFBizTestCase;</div><div class="line"></div><div class="line"><span class="comment">// 继承的OFBizTestCase中含有dispatcher和delegator两个对象，且最终继承了Junit的TestCase类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmPersonTest</span> <span class="keyword">extends</span> <span class="title">OFBizTestCase</span> </span>&#123;</div><div class="line">	<span class="keyword">protected</span> GenericValue userLogin = <span class="keyword">null</span>;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SmPersonTest</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(name);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// 在测试方法运行之前运行</span></div><div class="line">  	userLogin = delegator.findOne(<span class="string">"UserLogin"</span>, UtilMisc.toMap(<span class="string">"userLoginId"</span>, <span class="string">"system"</span>), <span class="keyword">false</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// 在测试方法运行之后运行</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 测试方法命名必须以test开头。程序进到该测试类后会运行所有test开头的方法</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateSmPerson</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">  	Map&lt;String, Object&gt; ctx = UtilMisc.&lt;String, Object&gt;toMap(<span class="string">"username"</span>, <span class="string">"smalleTestJava"</span>, <span class="string">"password"</span>, <span class="string">"12345678"</span>, <span class="string">"description"</span>, <span class="string">"这是ofbiz test的测试数据"</span>);</div><div class="line">      ctx.put(<span class="string">"userLogin"</span>, userLogin);</div><div class="line">    Map&lt;String, Object&gt; resp = dispatcher.runSync(<span class="string">"createSmPersonOfTestJava"</span>, ctx);</div><div class="line">    String flag = (String) resp.get(<span class="string">"flag"</span>);</div><div class="line">    assertNotNull(flag);</div><div class="line">    assertEquals(<span class="string">"false"</span>, flag);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/14/db/2016-08-14-mongodb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/14/db/2016-08-14-mongodb/" itemprop="url">mongodb</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T18:08:00+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="mongodb简介"><a href="#mongodb简介" class="headerlink" title="mongodb简介"></a>mongodb简介</h2><ul>
<li>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</li>
<li>官网：<a href="https://www.mongodb.com" target="_blank" rel="external">https://www.mongodb.com</a></li>
</ul>
<h2 id="mongodb安装"><a href="#mongodb安装" class="headerlink" title="mongodb安装"></a>mongodb安装</h2><ul>
<li><a href="https://www.mongodb.com/dr/fastdl.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-3.2.8-signed.msi/download" target="_blank" rel="external">下载地址</a></li>
<li>运行.msi文件，选择custom模式后可以选择安装位置(如：D:/software/mongodb)</li>
<li>进入到安装目录D:/software/mongodb</li>
<li>新建 <code>log</code> 和 <code>db</code> 两个文件夹</li>
</ul>
<h2 id="运行mongodb"><a href="#运行mongodb" class="headerlink" title="运行mongodb"></a>运行mongodb</h2><ol>
<li>法一：命令行运行<ul>
<li>cmd进入到安装目录的bin目录下</li>
<li>运行 <code>mongod.exe --dbpath D:\software\mongodb\db --auth</code><ul>
<li>其中参数<code>--auth</code>表示开启安全验证。如若不开启，则admin无密码登录可以查看admin下其他用户的数据</li>
</ul>
</li>
</ul>
</li>
<li>法二：将MongoDB服务器作为Windows服务运行<ul>
<li>(以管理员运行)cmd进入到安装目录的<code>D:\software\mongodb\bin</code>目录下</li>
<li>运行(注意参数说明) <code>mongod.exe --logpath &quot;D:\software\mongodb\log\mongodb.log&quot; --logappend --dbpath &quot;D:\software\mongodb\db&quot; --port 27017 --serviceName &quot;mongodb&quot; --serviceDisplayName &quot;mongodb&quot; --install</code><ul>
<li>参数描述<ul>
<li><code>--bind_ip 127.0.0.1</code>    绑定服务IP，若绑定127.0.0.1，数据库实例将只监听127.0.0.1的请求，即只能本机访问，不指定默认本地所有IP</li>
<li><code>--logpath</code>    定MongoDB日志文件，注意是指定文件不是目录</li>
<li><code>--logappend</code>    使用追加的方式写日志</li>
<li><code>--dbpath</code>    指定数据库路径</li>
<li><code>--port</code>    指定服务端口号，默认端口27017</li>
<li><code>--serviceName</code>    指定服务名称</li>
<li><code>--serviceDisplayName</code>    指定服务名称，有多个mongodb服务时执行。</li>
<li><code>--install</code>    指定作为一个Windows服务安装。</li>
</ul>
</li>
<li><code>mongod.exe --auth --logpath &quot;D:\software\mongodb\log\mongodb.log&quot; --logappend --dbpath &quot;D:\software\mongodb\db&quot; --port 27017 --serviceName &quot;mongodb&quot; --serviceDisplayName &quot;mongodb&quot; --reinstall</code> 其中<code>--auth</code>表示开启安全验证、<code>--reinstall</code>表示重新注册服务</li>
</ul>
</li>
<li>卸载：管理员运行<code>sc delete 服务名称</code></li>
</ul>
</li>
</ol>
<h2 id="MongoDB牛刀小试"><a href="#MongoDB牛刀小试" class="headerlink" title="MongoDB牛刀小试"></a>MongoDB牛刀小试</h2><p>MongoDB Shell是MongoDB自带的交互式Javascript shell,用来对MongoDB进行操作和管理的交互式环境。</p>
<ul>
<li>重启一个dos窗口，进入到安装目录的bin目录下</li>
<li>运行命令 <code>mongo</code>, 看到版本号则运行成功。当你进入mongoDB后台后，它默认会链接到 test 文档（数据库），mongodb默认内置有两个数据库，一个名为admin，一个名为local<ul>
<li><code>mongo --port 27017</code> 指定端口进行连接</li>
</ul>
</li>
<li>牛刀小试<ul>
<li>输入 <code>2+2</code> 回车，会打印 4</li>
<li>运行 <code>db</code> 查看当前数据库(test)</li>
<li>运行 <code>db.myvar.insert({&quot;num&quot;:10})</code> 表示将10插入到集合myvar的num字段中(直接运行后如果没有myvar的集合则新建一个)</li>
<li>运行 <code>db.myvar.find()</code> 会打印集合myvar的情况</li>
</ul>
</li>
</ul>
<h2 id="MongoDB使用"><a href="#MongoDB使用" class="headerlink" title="MongoDB使用"></a>MongoDB使用</h2><h3 id="设置用户名密码"><a href="#设置用户名密码" class="headerlink" title="设置用户名密码"></a>设置用户名密码</h3><ul>
<li><code>use admin</code> 切换到admin数据库</li>
<li><code>db.createUser({user:&quot;root&quot;,pwd:&quot;root&quot;,roles:[&quot;root&quot;]})</code> 创建管理员账号</li>
<li><code>db.auth(&quot;root&quot;,&quot;root&quot;)</code> 验证登录</li>
<li><code>exit</code> 退出</li>
<li>重新启动，并以<code>--auth</code>模式启动</li>
<li><code>mongo --port 27017 -u root -p root admin</code> 使用root/root登录admin数据库</li>
</ul>
<h3 id="MongoDB管理工具robomongo"><a href="#MongoDB管理工具robomongo" class="headerlink" title="MongoDB管理工具robomongo"></a>MongoDB管理工具robomongo</h3><ol>
<li>下载地址 <code>https://robomongo.org/download</code> (<code>Download portable version for Windows 64-bit</code>为免安装版)</li>
</ol>
<blockquote>
<p>参考文章</p>
<ul>
<li>[MongoDB 教程] <a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="external">http://www.runoob.com/mongodb/mongodb-tutorial.html</a></li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/14/middleware/2016-08-14-rabbitmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/14/middleware/2016-08-14-rabbitmq/" itemprop="url">RabbitMQ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T16:49:00+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index">
                    <span itemprop="name">middleware</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="RabbitMQ简介"><a href="#RabbitMQ简介" class="headerlink" title="RabbitMQ简介"></a>RabbitMQ简介</h2><ul>
<li>rabbitMQ是一个在AMQP协议(高级消息队列协议)标准基础上完整的，可服用的企业消息系统。他遵循Mozilla Public License开源协议。采用 Erlang 实现的工业级的消息队列(MQ)服务器。</li>
<li>RabbitMQ的官方站：<a href="http://www.rabbitmq.com/" target="_blank" rel="external">http://www.rabbitmq.com/</a></li>
</ul>
<h2 id="RabbitMQ安装"><a href="#RabbitMQ安装" class="headerlink" title="RabbitMQ安装"></a>RabbitMQ安装</h2><p>Rabbit MQ 是建立在强大的Erlang OTP平台上，因此安装Rabbit MQ的前提是安装Erlang。通过下面两个连接下载安装3.2.3 版本：</p>
<ul>
<li>安装 <a href="http://www.erlang.org/download/otp_win32_R16B03.exe" target="_blank" rel="external">Eralng OTP For Windows (vR16B03)</a></li>
<li>安装 <a href="https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.5/rabbitmq-server-3.6.5.exe" target="_blank" rel="external">RabbitMQ Server (3.6.5)</a></li>
<li>默认监听5672端口，后台使用端口15672</li>
</ul>
<h2 id="RabbitMQ启动"><a href="#RabbitMQ启动" class="headerlink" title="RabbitMQ启动"></a>RabbitMQ启动</h2><ul>
<li>激活Rabbit MQ’s Management Plugin(可激活管理插件)<ul>
<li>CMD进入RabbitMQ安装目录，进入到rabbitmq_server-3.6.5/sbin目录</li>
<li>运行 <code>rabbitmq-plugins.bat enable rabbitmq_management</code></li>
</ul>
</li>
<li>运行 <code>rabbitmq-service.bat start</code> 启动RabbitMQ服务</li>
<li>运行 <code>rabbitmq-service.bat stop</code> 停止服务</li>
<li>查看用户<ul>
<li>运行 <code>rabbitmqctl.bat list_users</code> 查看用户(有一个guest默认用户)</li>
</ul>
</li>
<li>登录管理后台<ul>
<li><code>http://localhost:15672</code> 使用guest/guest登录</li>
</ul>
</li>
</ul>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/07/21/linux/2016-07-21-linu-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/21/linux/2016-07-21-linu-system/" itemprop="url">linux系统命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-21T19:19:00+08:00">
                2016-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="系统命令"><a href="#系统命令" class="headerlink" title="系统命令"></a>系统命令</h2><ul>
<li><p>查看系统信息</p>
<ul>
<li><p>查看操作系统版本 <code>cat /proc/version</code></p>
<blockquote>
<p>如腾讯云服务器 <code>Linux version 3.10.0-327.36.3.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) ) #1 SMP Mon Oct 24 16:09:20 UTC 2016</code> 中的 <code>3.10.0</code> 表示内核版本 <code>x86_64</code> 表示是64位系统</p>
</blockquote>
</li>
<li><p>查看CentOS版本 <code>cat /etc/redhat-release</code> 如：CentOS Linux release 7.2.1511 (Core)</p>
</li>
<li>查看内存 <code>grep MemTotal /proc/meminfo</code></li>
</ul>
</li>
<li><p>查看启动的服务(不包括系统的)：<code>chkconfig --list</code></p>
</li>
<li><code>shutdown -r now</code> root登录可立刻重启</li>
<li><code>df -hl</code> 查看磁盘使用情况</li>
<li><code>netstat -lnp</code> 查看所有进场信息(端口、PID)<ul>
<li><code>ss -ant</code> CentOS 7 查看所有监听端口</li>
<li><code>netstat -tnl</code> 查看开放的端口</li>
<li><code>netstat -lnp | grep tomcat</code> 查看含有tomcat相关的进程</li>
</ul>
</li>
<li>安装程序包 <code>rpm -ivh 安装包名</code></li>
<li>查看安装程序(支持模糊查询) <code>rpm -qa | grep vsftpd</code> 查看是否安装vsftpd(一款ftp服务器软件)</li>
<li>检查网络连接 <code>ping 192.168.1.1</code>(或者<code>ping www.baidu.com</code>)，检查端口：<code>telnet 192.168.1.1 8080</code></li>
<li>查看进程信息 <code>top</code>, 推荐安装功能更强大的htop</li>
<li>关闭某个PID进程 <code>kill PID</code><ul>
<li><code>netstat -lnp</code> 查看所有进场信息(端口、PID)</li>
<li>强制杀进程 <code>kill -s 9 PID</code></li>
</ul>
</li>
<li>运行sh文件：进入到该文件目录，运行<code>./xxx.sh</code></li>
<li>脱机后台运行sh文件：<code>nohup bash startofbiz.sh &gt; my.log 2&gt;&amp;1 &amp;</code><ul>
<li>可解决利用客户端连接服务器，执行的程序当客户端退出后，服务器的程序也停止了</li>
<li><code>nohup</code>这个表示脱机执行，默认在当前目录生成一个<code>nohup.out</code>的日志文件</li>
<li><code>&amp;</code> 最后面的&amp;表示放在后台执行</li>
<li><code>startofbiz.sh &gt; my.log</code> 表示startofbiz.sh的输出重定向到my.log</li>
<li><code>2&gt;&amp;1</code> 表示将错误输出重定向到标准输出<ul>
<li><code>0</code>：键盘输入；<code>1</code>：标准输入；<code>2</code>：错误输出</li>
</ul>
</li>
</ul>
</li>
<li>查看内网ip <code>ip addr</code></li>
</ul>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h3><ol>
<li>查看磁盘使用情况 <code>df -hl</code></li>
<li>查看数据盘 <code>fdisk -l</code>(如：Disk：/dev/vda … Disk：/dev/vdb表示有两块磁盘)</li>
<li>格式化磁盘 <code>mkfs.ext4 /dev/vdb</code> (一般云服务器买的磁盘未进行格式化文件系统和挂载)</li>
<li>挂载磁盘 <code>mount /dev/vdb /home/</code> 挂载磁盘到<code>/home</code>目录</li>
<li>修改fstab以便系统启动时自动挂载磁盘 <code>echo &#39;/dev/vdb  /home ext4    defaults    0  0&#39; &gt;&gt; /etc/fstab</code> 重新挂载了磁盘需要重启(<code>reboot</code>)</li>
</ol>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><ul>
<li><code>cat &lt;fileName&gt;</code> 查看文件</li>
<li><code>touch &lt;fileName&gt;</code> 新建文件</li>
<li><code>vi &lt;fileName&gt;</code> 编辑文件<ul>
<li><code>vim &lt;fireName&gt;</code> 编辑文件，有的可能默认没有安装vim</li>
</ul>
</li>
<li><code>rm &lt;file&gt;</code> 删除文件<ul>
<li>提示 <code>rm: remove regular file &#39;test&#39;?</code> 时，在后面输入 <code>yes</code> 回车</li>
</ul>
</li>
<li><code>cp xxx.txt /usr/local/xxx</code> 复制文件(将xxx.txt移动到/usr/local/xxx)<ul>
<li>复制文件到远程服务器：<code>scp /home/test root@192.168.1.1:/home</code> 将本地linux系统的test文件或者文件夹复制到远程的home目录下</li>
</ul>
</li>
<li>重命名文件或目录、将文件由一个目录移入另一个目录中<ul>
<li><code>mv a.txt b.txt</code> (将a.txt重命名为b.txt)</li>
<li><code>mv a.txt /home/b.txt</code> 移动并重名名</li>
</ul>
</li>
<li><p><code>ls</code> 列举文件 <a href="[Linux文件属性](http://www.cnblogs.com/kzloser/articles/2673790.html)">^3</a></p>
<ul>
<li><code>ll</code> 列举文件详细<ul>
<li><code>ls *.txt</code>、<code>ll test*</code> 模糊查询</li>
<li><code>ll -rt *.txt</code> 按时间排序 (<code>-r</code>表示逆序、<code>-t</code>按时间排序)</li>
<li><code>ll -Sh</code> 按文件大小排序 (<code>-S</code>按文件大小排序、<code>-h</code>将文件大小按1024进行转换显示)</li>
</ul>
</li>
<li><code>ls -al</code> 列举所有文件详细<blockquote>
<p>文件详细如下图</p>
<p><img src="/data/images/2017/02/文件详细.gif" alt="文件详细"></p>
<p>类型与权限如下图</p>
<p><img src="//data/images/2017/02/类型与权限.gif" alt="类型与权限"></p>
<ul>
<li>第一个字符代表这个文件的类型(如目录、文件或链接文件等等)：<ul>
<li>[ d ]则是目录、[ - ]则是文件、[ l ]则表示为连结档(link file)、[ b ]则表示为装置文件里面的可供储存的接口设备(可随机存取装置)、[ c ]则表示为装置文件里面的串行端口设备,例如键盘、鼠标(一次性读取装置)</li>
</ul>
</li>
<li>接下来的字符中,以三个为一组,且均为『rwx』 的三个参数的组合&lt; [ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute) 要注意的是,这三个权限的位置不会改变,如果没有权限,就会出现减号[ - ]而已&gt;<ul>
<li>第一组为『文件拥有者的权限』、第二组为『同群组的权限』、第三组为『其他非本群组的权限』</li>
<li>当 s 标志出现在文件拥有者的 x 权限上时即为特殊权限。特殊权限如 SUID, SGID, SBIT</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p><code>file &lt;fileName&gt;</code> 查看文件属性</p>
</li>
<li><code>whereis &lt;fileName&gt;</code> 查询文件<ul>
<li><code>which &lt;exeName&gt;</code> 查询可执行文件位置 (在PATH路径中寻找)</li>
</ul>
</li>
<li><code>find / -name nginx.conf</code> 查询文件位置(查看<code>nginx.conf</code>文件所在位置)</li>
</ul>
<h3 id="文件夹-目录"><a href="#文件夹-目录" class="headerlink" title="文件夹/目录"></a>文件夹/目录</h3><ol>
<li>新建文件夹 <strong><code>mkdir [DirName]</code></strong> (或者用绝对路径 <code>mkdir /usr/local/DirName</code>)</li>
<li><p>删除文件夹</p>
<ul>
<li>删除文件夹 <code>rmdir [DirName]</code> (如果文件夹不为空则无法删除)</li>
<li>强制删除文件夹和其子文件夹 <strong><code>rm -rf [DirName]</code></strong><blockquote>
<p>-r 就是向下递归，不管有多少级目录，一并删除<br>-f 就是直接强行删除，不作任何提示的意思</p>
</blockquote>
</li>
</ul>
</li>
<li><p>切换目录</p>
<ul>
<li>进入目录 <strong><code>cd</code> DirName</strong></li>
<li>返回上一级目录 <code>cd ..</code></li>
<li>返回某一级目录 <strong><code>cd</code> /usr/local/xxx</strong></li>
<li>返回根目录 <code>cd ~</code> 或者 <code>cd $HOME</code></li>
</ul>
</li>
<li><p>查看当前目录绝对路径 <code>pwd</code></p>
</li>
<li>查看目录结构 <code>ls</code><ul>
<li>查看目录结构包括隐藏文件 <code>ls -a</code></li>
</ul>
</li>
</ol>
<h3 id="压缩包-推荐tar-1"><a href="#压缩包-推荐tar-1" class="headerlink" title="压缩包(推荐tar) ^1"></a>压缩包(推荐tar) <a href="[文件压缩与解压](http://www.jb51.net/LINUXjishu/43356.html)">^1</a></h3><ol>
<li><p>解压</p>
<ul>
<li><p><code>tar -xvf archive.tar</code> 解压tar包(tar不存在乱码问题)</p>
<ul>
<li><p>参数说明</p>
<ul>
<li>独立命令，压缩解压都要用到其中一个，可以和别的命令连用但只能用其中一个<ul>
<li><code>-c</code>: 建立压缩档案</li>
<li><code>-x</code>：解压</li>
<li><code>-t</code>：查看 tarfile 里面的文件</li>
<li><code>-r</code>：向压缩归档文件末尾追加文件</li>
<li><code>-u</code>：更新原压缩包中的文件</li>
</ul>
</li>
<li>必须<ul>
<li><code>-f</code>：使用档案名字，切记，这个参数是最后一个参数，后面只能接档案名</li>
</ul>
</li>
<li>可选<ul>
<li><code>-z</code>：有gzip属性的</li>
<li><code>-j</code>：有bz2属性的</li>
<li><code>-Z</code>：有compress属性的</li>
<li><code>-v</code>：显示所有过程</li>
<li><code>-O</code>：将文件解开到标准输出    </li>
<li><code>-p</code> 使用原文件的原来属性（属性不会依据使用者而变）</li>
<li><code>-P</code> 可以使用绝对路径来压缩        </li>
</ul>
</li>
</ul>
</li>
<li><p>常用命令</p>
<ul>
<li><code>tar -xvf archive.tar -C /tmp</code> 将压缩包释放到 /tmp目录下</li>
<li><code>tar -xzvf archive.tar.gz</code> 解压tar.gz</li>
<li><code>tar -xjvf archive.tar.bz2</code> 解压tar.bz2</li>
<li><code>tar -xZvf archive.tar.Z</code> 解压tar.Z</li>
</ul>
</li>
</ul>
</li>
<li><code>unzip file.zip</code> 解压zip</li>
<li><code>unrar e archive.rar</code> 解压rar</li>
</ul>
</li>
<li>压缩<ul>
<li><strong><code>tar -czf aezocn.tar.gz *.jpg dir1</code></strong> 将此目录所有jpg文件和dir1目录打包成aezocn.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为aezocn.tar.gz(体积会小很多：1/10)</li>
<li><code>tar -cvf aezocn.tar file1 file2 dir1</code> 同时压缩 file1, file2 以及目录 dir1。windows可使用7-zip</li>
<li><code>tar -cvf aezocn.tar *.jpg</code> 将目录里所有jpg文件打包成aezocn.jpg</li>
<li><code>tar -cjf aezocn.tar.bz2 *.jpg</code> 将目录里所有jpg文件打包成aezocn.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2</li>
<li><code>tar -cZf aezocn.tar.Z *.jpg</code> 将目录里所有jpg文件打包成aezocn.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z</li>
<li><code>rar a aezocn.rar *.jpg</code> rar格式的压缩，需要先下载rar for linux</li>
<li><code>zip aezocn.zip *.jpg</code> zip格式的压缩，需要先下载zip for linux</li>
</ul>
</li>
<li><p>unzip乱码</p>
<ul>
<li><p>使用python解决(只能解决部分问题)</p>
<ul>
<li><code>vi pyzip</code> 新建文件pyzip</li>
<li><p>加入代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># pyzip.py</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> zipfile</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">"Processing File "</span> + sys.argv[<span class="number">1</span>]</div><div class="line"></div><div class="line">file=zipfile.ZipFile(sys.argv[<span class="number">1</span>],<span class="string">"r"</span>);</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> file.namelist():</div><div class="line">    utf8name=name.decode(<span class="string">'gbk'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">"Extracting "</span> + utf8name</div><div class="line">    pathname = os.path.dirname(utf8name)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pathname) <span class="keyword">and</span> pathname!= <span class="string">""</span>:</div><div class="line">        os.makedirs(pathname)</div><div class="line">    data = file.read(name)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(utf8name):</div><div class="line">        fo = open(utf8name, <span class="string">"w"</span>)</div><div class="line">        fo.write(data)</div><div class="line">        fo.close</div><div class="line">file.close()</div></pre></td></tr></table></figure>
</li>
<li><p><code>chmod +x pyzip</code> 将pyzip设置成可执行文件</p>
</li>
<li><code>./uzip /home/xxxx.zip</code></li>
</ul>
</li>
</ul>
</li>
<li><p>rar安装问题，unzip乱码问题</p>
</li>
</ol>
<h2 id="权限系统"><a href="#权限系统" class="headerlink" title="权限系统"></a>权限系统</h2><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><ol>
<li>添加用户<code>useradd aezo –d /home/aezo/</code><ul>
<li>修改用户宿主目录<code>usermod -d /home/home_dir -U aezo</code></li>
</ul>
</li>
<li>设置密码<code>passwd aezo</code></li>
<li>查看用户<code>vi /etc/passwd</code></li>
</ol>
<h3 id="文件-1"><a href="#文件-1" class="headerlink" title="文件"></a>文件</h3><ul>
<li>文件属性<code>chgrp</code>、<code>chown</code>、<code>chmod</code>、<code>umask</code> <a href="[Linux文件属性](http://www.cnblogs.com/kzloser/articles/2673790.html)">^3</a><ul>
<li><code>chgrp</code> 改变文件所属群组。<code>chgrp [-R] 组名 文件或目录</code><ul>
<li><code>-R</code> 递归设置子目录下所有文件和目录</li>
</ul>
</li>
<li><code>chown</code> 改变文件/目录拥有者。如：<code>chown [-R] aezo /home/aezo</code></li>
<li><code>chmod</code> 改变文件的权限。<ul>
<li>数字类型改变文件权限 <code>chmod [-R] xyzw 文件或目录</code> 如：<code>chmod -R 755 /home/ftproot</code><ul>
<li>x : 可有可无,代表的是特殊权限,即 SUID/SGID/SBIT。yzw : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加</li>
<li>各权限的分数对照表为：r:4、w:2、x:1、SUID:4、SGID:2、SBIT:1。如rwx = 4+2+1 = 7，r-s = 4+1 = 5</li>
</ul>
</li>
<li>符号类型改变文件权限 <code>chmod 对象 操作符 文件/目录</code><ul>
<li>对象取值为<code>ugoa</code>：u=user, g=group, o=others, a=all</li>
<li>操作符取值为：<code>+-=</code>：+ 为增加，- 为除去，= 为设定</li>
<li>如：<code>chmod u=rwx,go=rx test</code>、<code>chmod g+s,o+t test</code></li>
</ul>
</li>
</ul>
</li>
<li><code>umask</code> 创建文件时的默认权限<ul>
<li><code>umask</code> 查看umask分数值。如0022(一般umask分数值指后面三个数字)<ul>
<li><code>umask -S</code> 查看umask。如u=rwx,g=rx,o=rx</li>
</ul>
</li>
<li>系统默认新建文件的权限为666(3个rw)，文件夹为777(3个rwx)。最终新建文件的默认权限为系统默认权限减去umask分数值。如umask为002，新建的文件为-rw-r–r–，文件夹为drw-r-xr-x</li>
</ul>
</li>
<li>常用命令<ul>
<li><code>find . -type d -exec chmod 755 {} \;</code> 修改当前目录的所有目录为775</li>
<li><code>find . -type f -exec chmod 644 {} \;</code> 修改当前目录的所有文件为644</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ssh-2"><a href="#ssh-2" class="headerlink" title="ssh ^2"></a>ssh <a href="[ssh登录](http://www.linuxidc.com/Linux/2016-03/129204.htm)">^2</a></h2><h3 id="ssh介绍"><a href="#ssh介绍" class="headerlink" title="ssh介绍"></a>ssh介绍</h3><ol>
<li>SSH是建立在传输层和应用层上面的一种安全的传输协议。SSH目前较为可靠，专为远程登录和其他网络提供的安全协议。在主机远程登录的过程中有两种认证方式：<ul>
<li><code>基于口令认证</code>：只要你知道自己帐号和口令，就可以登录到远程主机。所有传输的数据都会被加密，但是不能保证你正在连接的服务器就是你想连接的服务器。可能会有别的服务器在冒充真正的服务器，也就是受到“中间人”这种方式的攻击。</li>
<li><code>基于秘钥认证</code>：需要依靠秘钥，也就是你必须为自己创建一对秘钥，并把公用的秘钥放到你要访问的服务器上，客户端软件就会向服务器发出请求，请求用你的秘钥进行安全验证。服务器收到请求之后，现在该服务器你的主目录下寻找你的公用秘钥，然后吧它和你发送过来的公用秘钥进行比较。弱两个秘钥一致服务器就用公用秘钥加密“质询”并把它发送给客户端软件，客户端软件收到质询之后，就可以用你的私人秘钥进行解密再把它发送给服务器。</li>
</ul>
</li>
<li>用基于秘钥认证，你必须要知道自己的秘钥口令。但是与第一种级别相比，这种不需要再网络上传输口令。第二种级别不仅加密所有传送的数据，而且“中间人”这种攻击方式也是不可能的（因为他没有你的私人密匙）。但是整个登录的过程可能需要10秒。</li>
</ol>
<h3 id="查看SSH服务"><a href="#查看SSH服务" class="headerlink" title="查看SSH服务"></a>查看SSH服务</h3><p>CentOS 7.1安装完之后默认已经启动了ssh服务我们可以通过以下命令来查看ssh服务是否启动</p>
<ol>
<li>查看开放的端口 <code>netstat -tnl</code> ssh默认端口为22</li>
<li>查看服务是否启动 <code>systemctl status sshd.service</code> 查看ssh服务是否启动</li>
</ol>
<h3 id="SSH客户端连接服务器（口令认证）"><a href="#SSH客户端连接服务器（口令认证）" class="headerlink" title="SSH客户端连接服务器（口令认证）"></a>SSH客户端连接服务器（口令认证）</h3><ol>
<li>直接连接到对方的主机，这样登录服务器的默认用户<ul>
<li><code>ssh 192.168.1.1</code> 回车输入密码即可</li>
<li><code>exit</code> 退出登录</li>
</ul>
</li>
<li>使用账号登录对方主机aezocn用户<ul>
<li><code>ssh aezocn@192.168.1.1</code></li>
</ul>
</li>
</ol>
<h3 id="SSH客户端连接服务器（秘钥认证）"><a href="#SSH客户端连接服务器（秘钥认证）" class="headerlink" title="SSH客户端连接服务器（秘钥认证）"></a>SSH客户端连接服务器（秘钥认证）</h3><ol>
<li>命令行生成<ul>
<li>生成公钥(.pub)和私钥(.ppk)<ul>
<li><code>ssh-keygen</code> 运行命令后再按三次回车会看到<code>RSA</code>（生成的秘钥默认路径为<code>/root/.ssh/</code>，会包括<code>id_rsa</code>(密钥)、<code>id_rsa.pub</code>(公钥)、<code>known_hosts</code> 3 个文件）</li>
</ul>
</li>
<li>把生成的公钥发送到对方的主机上去（在本地为服务器生成公钥）<ul>
<li><code>ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.1</code> （自动保存在对方主机的<code>/root/.ssh/authorized_keys</code>文件中去）</li>
<li>输入该服务器密码实现发送</li>
</ul>
</li>
<li>登录该服务器：<code>ssh 192.168.1.1</code> 此时不需要输入密码（默认生成密钥的服务器已经有了私钥）</li>
<li><strong>注：</strong> 如果是为了让root用户登录则将公钥放入到/root/.ssh目录；如果密钥提供给其他用户登录，可将公钥放在对应的家目录，如/home/aezo/.ssh/下。<code>.ssh</code>目录默认已经存在（可通过<code>ll -al</code>查看）</li>
</ul>
</li>
<li>Putty/WinSCP 和 xshell/xftp<ul>
<li>Putty是一个Telnet、SSH、rlogin、纯TCP以及串行接口连接软件。它包含Puttygen等工具，Puttygen可用于生成公钥和密钥（还可以将如AWS亚马逊云的密钥文件.pem转换为.ppk的通用密钥文件）<ul>
<li>在知道密钥文件时，可以通过Putty连接到服务器(命令行)，通过WinSCP连接到服务器的文件系统(FTP形式显示)</li>
<li>Puttygen使用：<code>类型选择RSA，大小2048</code> - <code>点击生成</code> - <code>鼠标在空白处滑动</code> - <code>保存公钥和密钥</code></li>
<li>Putty使用：<code>Session的Host Name输入username@ip，端口22</code> - <code>Connection-SSH-Auth选择密钥文件</code> - <code>回到Session，在save session输入一个会话名称</code> - <code>点击保存会话</code> - <code>点击open登录服务器</code> - <code>下次可直接点击会话名称登录</code></li>
</ul>
</li>
<li>xshell/xftp是一个连接ssh的客户端<ul>
<li>登录方法：连接 - 用户身份验证 - 方法选择”public key” 公钥 - 用户名填入需要登录的用户 - 用户密钥可点击浏览生成(需要将生成的公钥保存到对应用户的.ssh目录<code>mv /home/aezo/id_rsa.pub /home/aezo/.ssh/authorized_keys</code>)。必须使用自己生成的公钥和密钥，如果AWS亚马逊云转换后的ppk文件无法直接登录。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="定时任务-4"><a href="#定时任务-4" class="headerlink" title="定时任务 ^4"></a>定时任务 <a href="[定时任务](http://www.360doc.com/content/16/1013/10/15398874_598063092.shtml)">^4</a></h2><ol>
<li><p>配置式</p>
<ul>
<li><p>添加定时配置：<code>sudo vim /etc/crontab</code>，配置说明如下，如：<code>30 2 1 * * root /sbin/reboot</code>表示每月第一天的第2个小时的第30分钟，使用root执行命令/sbin/reboot(重启)</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> Example of job definition:</span></div><div class="line"><span class="meta">#</span><span class="bash"> .---------------- minute (0 - 59)</span></div><div class="line"><span class="meta">#</span><span class="bash"> |  .------------- hour (0 - 23)</span></div><div class="line"><span class="meta">#</span><span class="bash"> |  |  .---------- day of month (1 - 31)</span></div><div class="line"><span class="meta">#</span><span class="bash"> |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></div><div class="line"><span class="meta">#</span><span class="bash"> |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></div><div class="line"><span class="meta">#</span><span class="bash"> |  |  |  |  |</span></div><div class="line"><span class="meta">#</span><span class="bash"> *  *  *  *  * user-name  <span class="built_in">command</span> to be executed</span></div><div class="line"><span class="meta">#</span><span class="bash"> (1) 其中用户名一般可以省略</span></div><div class="line"><span class="meta">#</span><span class="bash"> (2) 精确到秒解决方案, 以下3行表示每20秒执行一次</span></div><div class="line"><span class="meta">#</span><span class="bash"> * * * * * user-name my-command</span></div><div class="line"><span class="meta">#</span><span class="bash"> * * * * * sleep 20; user-name my-command</span></div><div class="line"><span class="meta">#</span><span class="bash"> * * * * * sleep 40; user-name my-command</span></div></pre></td></tr></table></figure>
</li>
<li><p><code>systemctl reload crond</code> 重新加载配置</p>
</li>
<li><code>systemctl restart crond</code> 重启crond</li>
</ul>
</li>
</ol>
<hr>
<p>参考文章</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/07/17/design/2016-07-17-uml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/17/design/2016-07-17-uml/" itemprop="url">UML</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-17T11:01:00+08:00">
                2016-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/design/" itemprop="url" rel="index">
                    <span itemprop="name">design</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="UML介绍"><a href="#UML介绍" class="headerlink" title="UML介绍"></a>UML介绍</h2><ol>
<li><p><code>UML</code>(Unified Modeling Language): 统一建模语言，是一种图形化的语言，它可以帮助我们在OOAD过程中标识元素、构建模块、分析过程并可通过文档说明系统中的重要细节。</p>
<blockquote>
<ul>
<li><code>OO</code>(Object Oriented)：面向对象</li>
<li><code>OOAD</code>(OOA&amp;D)：面向对象的分析与设计</li>
<li><code>OOP</code>(Object Oriented Programming)：面向对象编程</li>
<li>OOP的主要特征：<code>抽象</code>(abstract)、<code>封装</code>(encapsulation)、<code>继承</code>(inheritance)、<code>多态</code>(polymorphism)、<code>关联</code>(association)、<code>聚合</code>(aggregation)、<code>组合</code>(composition)、<code>内聚与耦合</code>(cohesion &amp; coupling)</li>
<li><code>RUP</code>(Rational Unified Process)：统一过程，是一个采用面向对象思想，使用UML作为软件分析设计语言，并结合了项目管理、质量管理等软件工程知识综合而成的软件方法。RUP分为四个阶段：<code>初始</code>，<code>精化</code>，<code>构建</code>（编码），<code>交付</code>（使用部署图）。RUP拥抱了需求的变化，好于瀑布式开发（照搬建筑模型，需求变化后修改很麻烦）</li>
</ul>
</blockquote>
</li>
<li>UML包括：事物、关系、图、扩展机制</li>
<li>事物包括：<ul>
<li>结构：类、接口、构件、节点等</li>
<li>行为：交互（消息）、状态等</li>
<li>分组：包、子系统等</li>
<li>注释：注释</li>
</ul>
</li>
<li><strong>关系</strong> 包括：<code>依赖</code>、<code>关联</code>、<code>泛化</code>(extend、继承)、<code>实现</code></li>
<li><strong>九种建模图</strong> 即：<code>用例图</code>(User Case)、<code>类图</code>、<code>对象图</code>、<code>顺序图</code>(Sequence)、<code>协作图</code>(Collaboration)、<code>状态图</code>(Statechart)、<code>活动图</code>(Activity)、<code>组件图</code>、<code>配置图</code></li>
<li>使用UML完成项目顺序<ol>
<li>完成User Case以及document</li>
<li>对于比较复杂的User Case 使用Activity活动图辅助说明或者Sequence顺序图</li>
<li>根据User Case Document和Activity 分析业务领域的概念，抽象出概念模型</li>
<li>根据概念模型抽象出类</li>
<li>分析类的职责与关系做出类图，通常先不做方法，制作属性然后做6，然后根据这抽象出方法</li>
<li>根据类图制作出Sequence顺序图、Collaboration协作图、Statechart状态图等各种图示</li>
<li>根据图示重复迭代5-6，直至“完美”，没有完美，够用就行了</li>
<li>Coding编码</li>
<li>测试并修改，必要从前面开始改起，或从1，或从5（内部测试）</li>
<li>部署并与用户一起测试</li>
<li>从实施与测试的反馈驱动下一次的1-&gt;11（交付用户测试）</li>
</ol>
</li>
</ol>
<h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p>UML中的关系包括：依赖、关联、泛化(extend)、实现</p>
<ol>
<li><p><code>依赖</code>(Dependence)：虚线箭头</p>
<p> <img src="/data/images/2016/07/依赖.png" alt="依赖关系"></p>
<p> 低耦合：表示要降低跟不稳定的对象之间的依赖关系</p>
</li>
<li><p><code>关联</code>(Associations)：实线箭头</p>
<p> 相关概念：关联名、导航(单向关联/双向关联)、角色、多重性、聚合、组合</p>
<ul>
<li><p>导航性：</p>
<p>  <img src="/data/images/2016/07/导航性.png" alt="导航性"></p>
</li>
<li><p>角色：</p>
<p>  <img src="/data/images/2016/07/角色.png" alt="角色"></p>
</li>
<li><p>多重性：</p>
<p>  <img src="/data/images/2016/07/多重性.png" alt="多重性"></p>
</li>
<li><p>聚合和组合（聚合是一种关联，组合是一种聚合）</p>
<p>  <img src="/data/images/2016/07/聚合和组合.png" alt="聚合和组合"></p>
</li>
</ul>
</li>
<li><p><code>泛化</code>(Extend、继承)：实线三角箭头</p>
<p> <img src="/data/images/2016/07/泛化.png" alt="泛化"></p>
</li>
<li><p><code>实现</code>(Implement/Realize)：虚线三角箭头</p>
<p> <img src="/data/images/2016/07/实现.png" alt="实现"></p>
</li>
</ol>
<h2 id="建模图"><a href="#建模图" class="headerlink" title="建模图"></a>建模图</h2><ul>
<li>用于描述系统结构：<ul>
<li>用例图：需求捕获，测试依据</li>
<li>类图：静态系统架构</li>
<li>对象图：对象之间的关联</li>
<li>构件图：构件之间的关联</li>
<li>部署图：构件的物理部署</li>
</ul>
</li>
<li>用于描述系统行为：<ul>
<li>顺序图：不活User Case 在某个时间场景上时间执行顺序</li>
<li>协作图：强调对象之间的写作（顺序图与协作图之间可以互相转换，而其中的信息不会丢失）</li>
<li>状态图：描述关键类生命周期的转化</li>
<li>活动图：流程图，描述某个方法或User Case的执行过程。</li>
</ul>
</li>
</ul>
<p>通常合在一块使用，如下图：</p>
<p><img src="/data/images/2016/07/UML建模图.png" alt="UML建模图"></p>
<h3 id="用例图-user-case-diagram"><a href="#用例图-user-case-diagram" class="headerlink" title="用例图(user case diagram)"></a>用例图(user case diagram)</h3><ul>
<li>用例(Use Case)是文本形式的情节描述，用于需求的发现和记录，用例会影响后续的OOA/D工作。用例是一组相关的成功或失败的集合</li>
<li><p>用例的编写</p>
<ul>
<li>用例编号</li>
<li>用例名</li>
<li>用例描述</li>
<li>参与者</li>
<li>前置条件 //必须满足条件</li>
<li>后置条件 //用例做完后，对系统的影响</li>
<li>基本路径(1、2、3、) //最重要，主功能场景，只描述正常成功的场景，不要出现如果….;参与者动作，系统响应</li>
<li>扩展点(2.a、3.a)</li>
<li>补充说明 //对基本路径和扩展点的未尽事宜进行描述</li>
</ul>
<p><img src="/data/images/2016/07/用例图.png" alt="用例图"></p>
<p><img src="/data/images/2016/08/用例图.png" alt="用例图"></p>
</li>
</ul>
<h3 id="类图-class-diagram"><a href="#类图-class-diagram" class="headerlink" title="类图(class diagram)"></a>类图(class diagram)</h3><ul>
<li>UML中使用最多的图形，可用于对概念建模（领域模型）、分析类图</li>
<li><p>领域模型(domain model)：包括概念、关系、属性，业务领域的概念名词。可用于现实世界与软件实现之间的过渡。</p>
<p><img src="/data/images/2016/07/类图.png" alt="类图"></p>
</li>
</ul>
<h3 id="顺序图-sequence-diagram-与协作图-collaboration-diagram"><a href="#顺序图-sequence-diagram-与协作图-collaboration-diagram" class="headerlink" title="顺序图(sequence diagram)与协作图(collaboration diagram)"></a>顺序图(sequence diagram)与协作图(collaboration diagram)</h3><ul>
<li><p>顺序图强调消息时间顺序的交互图</p>
<p>  <img src="/data/images/2016/07/顺序图.png" alt="顺序图"></p>
</li>
<li><p>协作图则是强调发送和接收消息对象的结构组件的交互图</p>
<p>  <img src="/data/images/2016/07/协作图.png" alt="协作图"></p>
</li>
<li><p>Rational Rose中顺序图转协作图：Browse -&gt; Go To Collaboration Diagram</p>
</li>
<li>Rational Rose中协作图转顺序图：Browse -&gt; Go To Sequence Diagram</li>
</ul>
<h3 id="状态图-statechart-diagram"><a href="#状态图-statechart-diagram" class="headerlink" title="状态图(statechart diagram)"></a>状态图(statechart diagram)</h3><p>  <img src="/data/images/2016/08/状态图.png" alt="状态图"></p>
<h3 id="活动图-activity-diagram"><a href="#活动图-activity-diagram" class="headerlink" title="活动图(activity diagram)"></a>活动图(activity diagram)</h3><p>  <img src="/data/images/2016/08/活动图.png" alt="活动图"></p>
<h2 id="StarUML使用-1"><a href="#StarUML使用-1" class="headerlink" title="StarUML使用 ^1"></a>StarUML使用 <a href="[StarUML工具介绍.ppt](https://wenku.baidu.com/view/bfc2d0d610a6f524ccbf85f2.html)">^1</a></h2><ul>
<li><code>Model Explorer</code> 模型浏览区</li>
<li><code>Diagram Explorer</code> 建模图浏览区</li>
<li><code>Properties</code> 设置属性区域，可以修改某个元素的属性，如名称</li>
<li><code>Documentation</code> 文档注释区域，可以为某个元素添加注释</li>
<li><code>Attachments</code> 附件区，可以为某个元素添加附件，如图片说明等</li>
<li>时序图<ul>
<li>时序图中形如<code>:MyClass</code>的对象可以理解为<code>MyClass</code>的一个实例</li>
<li>时序图中虚线返回线怎么画?<ul>
<li>选中这个线，在右下角有个设置属性区域，把ActionKind的值由CALL改为RETURN</li>
</ul>
</li>
<li><code>Combined Fragment</code> 交互片段<ul>
<li><code>alt</code> 选择性片段，多条件分支；用虚线分割(<code>Interaction Operand</code>)，每个区域代表一个分支</li>
<li><code>opt</code> 满足条件则执行分支</li>
<li><code>loop</code> 循环</li>
<li><code>par</code> 并行执行</li>
<li><code>region</code> 只能执行一个线程的临界片段</li>
<li><code>break</code> 中断</li>
<li><code>assert</code> 断言</li>
<li><code>ignore</code> 忽略</li>
</ul>
</li>
<li><code>Interaction Operand</code> 结合Combined Fragment使用</li>
<li><code>Frame</code> 框图，简化时序图复杂度<ul>
<li><code>sd</code> 框图定义</li>
<li><code>ref</code> 框图引用</li>
</ul>
</li>
</ul>
</li>
<li>导出PDF：<code>File</code>-<code>Print</code>-<code>Size(Tile:1-1)</code></li>
</ul>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/07/11/middleware/2016-07-11-rocketmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/11/middleware/2016-07-11-rocketmq/" itemprop="url">RocketMQ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-11T09:26:00+08:00">
                2016-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index">
                    <span itemprop="name">middleware</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="RocketMQ简介"><a href="#RocketMQ简介" class="headerlink" title="RocketMQ简介"></a>RocketMQ简介</h2><ul>
<li>RocketMQ是阿里巴巴开源的分布式、队列模型的消息中间件。</li>
<li><a href="https://github.com/alibaba/RocketMQ" target="_blank" rel="external">【GitHub源码】</a> <a href="https://github.com/alibaba/RocketMQ/releases/download/v3.2.6/alibaba-rocketmq-3.2.6.tar.gz" target="_blank" rel="external">【下载地址(v3.2.6)】</a></li>
<li>文档：<a href="/data/doc/middleware/RocketMQ Developer Guide.pdf">RocketMQ Developer Guide.pdf</a></li>
</ul>
<h2 id="启动RocketMQ服务"><a href="#启动RocketMQ服务" class="headerlink" title="启动RocketMQ服务"></a>启动RocketMQ服务</h2><ol>
<li>启动mqnamesrv.exe（在bin目录下，也有对应Linux的启动程序）</li>
<li>启动mqbroker.exe<ul>
<li>最好不要直接双击，而是应该在CMD中输入<code>mqbroker.exe -n localhost:9876</code></li>
<li><code>mqbroker.exe -h</code>查看相关命令帮助</li>
</ul>
</li>
</ol>
<blockquote>
<p>关于命令行</p>
<ol>
<li>可启动mqadmin.exe查看相关命令（不能直接双击，要在cmd命令行中启动）<ul>
<li>启动mqadmin.exe后可运行一些命令，如<code>mqadmin topicList -n 192.168.0.1:9876</code>查看该NameServer所有的topic</li>
<li>可运行<code>mqadmin help 命令</code>或者某个命令的更多帮助</li>
<li>mqadmin.exe启动后可以新增/更新Topic（因为Broker默认关闭了自动创建Topic功能，可能会导致Producer向Broker发送消息，服务器校验不通过，<a href="https://github.com/alibaba/RocketMQ/issues/38" target="_blank" rel="external">详细issure</a>）</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="Producer生产者"><a href="#Producer生产者" class="headerlink" title="Producer生产者"></a>Producer生产者</h2><h3 id="Producer启动"><a href="#Producer启动" class="headerlink" title="Producer启动"></a>Producer启动</h3><ul>
<li>一个应用创建一个Producer，由应用来维护此对象，可以设置为全局对象或者单例。</li>
<li>ProducerGroupName需要由应用来保证唯一。ProducerGroup这个概念发送普通的消息时，作用不大，但是发送分布式事务消息时，比较关键，因为服务器会回查这个Group下的任意一个Producer</li>
<li>Producer对象在使用之前必须要调用start初始化，初始化一次即可。可伴随应用启动而启动。切记不可以在每次发送消息时，都调用start方法</li>
<li>代码如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(<span class="string">"UniqueProducerGroupName"</span>); <span class="comment">// 保证UniqueProducerGroupName唯一</span></div><div class="line">producer.setNamesrvAddr(<span class="string">"127.0.0.1:9876"</span>); <span class="comment">// 设置NameServer地址</span></div><div class="line">producer.setInstanceName(<span class="string">"Producer"</span>); <span class="comment">// 客户端实例名称</span></div><div class="line">producer.start();</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Producer发送消息"><a href="#Producer发送消息" class="headerlink" title="Producer发送消息"></a>Producer发送消息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Message msg = <span class="keyword">new</span> Message(<span class="string">"TopicTest1"</span>, <span class="string">"TagA"</span>, <span class="string">"OrderID2016061001"</span>, (<span class="string">"Hello"</span>).getBytes());</div><div class="line">msg.putUserProperty(<span class="string">"orderId"</span>, <span class="string">"OrderID2016061001"</span>); <span class="comment">// 设置参数</span></div><div class="line">SendResult sendResult = producer.send(msg);</div><div class="line">System.out.println(sendResult);</div></pre></td></tr></table></figure>
<ul>
<li>此示例中实例化Message的参数分别为Topic(主题，必填唯一)、Tag(该主题下的细化类型，可选)、Key(可选唯一)、Body(消息的body)</li>
<li>一个应用尽可能用一个 Topic，消息子类型用 tags 来标识</li>
<li>如果是第一次发送/接收某主题的消息，broker中无此topic，可能会报错(No topic route info in name server for the topic:XXX，无此topic的路由信息)，第二次就不会报错。可以尝试发送消息前就将此topic加到broker中(如运行命令<code>mqadmin updateTopic -b 192.168.0.1:10911 -n 192.168.0.1:9876 -t NewTopicName</code>)</li>
</ul>
<h3 id="Producer关闭"><a href="#Producer关闭" class="headerlink" title="Producer关闭"></a>Producer关闭</h3><ul>
<li>应用退出时，要调用shutdown来清理资源，关闭网络连接，从MetaQ(RocketMQ前身)服务器上注销自己</li>
<li>建议应用在JBOSS、Tomcat等容器的退出钩子里调用shutdown方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">producer.shutdown();</div></pre></td></tr></table></figure>
<h2 id="Consumer消费者"><a href="#Consumer消费者" class="headerlink" title="Consumer消费者"></a>Consumer消费者</h2><ul>
<li>一个应用创建一个Consumer，由应用来维护此对象，可以设置为全局对象或者单例</li>
<li>ConsumerGroupName需要由应用来保证唯一</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"UniqueConsumerGroupName"</span>);</div><div class="line">consumer.setNamesrvAddr(<span class="string">"127.0.0.1:9876"</span>);</div><div class="line">consumer.setInstanceName(<span class="string">"Consumber"</span>);</div><div class="line">consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET); <span class="comment">// 设置Consumer第一次启动是从队列头部开始消费还是队列尾部开始消费，如果非第一次启动，那么按照上次消费的位置继续消费</span></div><div class="line">  consumer.subscribe(<span class="string">"TopicTest1"</span>, <span class="string">"TagA"</span>); <span class="comment">// 订阅指定topic为TopicTest1下TagA类型的消息。一个consumer可订阅多个主题</span></div><div class="line">  consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerConcurrently() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs,</span></span></div><div class="line">              ConsumeConcurrentlyContext context) &#123;</div><div class="line">          <span class="comment">// 开始消费</span></div><div class="line">          System.out.println(Thread.currentThread().getName() + <span class="string">" Receive New Messages: "</span> + msgs);</div><div class="line">          String orderId = msg.getUserProperty(<span class="string">"orderId"</span>); <span class="comment">// 获取参数值</span></div><div class="line">          <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</div><div class="line">      &#125;</div><div class="line">  &#125;);</div><div class="line">  consumer.start();</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/07/07/others/2016-07-07-projectrule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/07/others/2016-07-07-projectrule/" itemprop="url">项目开发规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-07T09:38:00+08:00">
                2016-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/extend/" itemprop="url" rel="index">
                    <span itemprop="name">extend</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前台"><a href="#前台" class="headerlink" title="前台"></a>前台</h2><h3 id="文件命名"><a href="#文件命名" class="headerlink" title="文件命名"></a>文件命名</h3><p>针对一个功能的前台页面(ftl/jsp)应该以名词开头，如果功能名称为”设置用户信息”，可起名为”userInfoSet”而不用”setUserInfo”(这一般像是方法名)</p>
<h3 id="查询选项"><a href="#查询选项" class="headerlink" title="查询选项"></a>查询选项</h3><ol>
<li>input输入，主键外键的字段查询条件为等于，其他字段无特殊要求为左右模糊；下拉框为等于</li>
</ol>
<h3 id="查询结果"><a href="#查询结果" class="headerlink" title="查询结果"></a>查询结果</h3><h2 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h2><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ol>
<li>参数验证<ul>
<li>方法内部需要对必须的参数进行验证，如方法有个形参username，内部拿到username的值去操作数据时，当username为空时报错，则此时在方法开始代码块中需对username进行非空判断</li>
<li>验证一般包括：非空验证、类型验证(项目实践中一般会遇到Long和String的验证)等</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/07/06/java/others/2016-07-06-javacodestyle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Smalle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SmalleBlog | AEZOCN">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/06/java/others/2016-07-06-javacodestyle/" itemprop="url">javacodestyle - Java开发规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-06T08:39:00+08:00">
                2016-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="源文件基础"><a href="#源文件基础" class="headerlink" title="源文件基础"></a>源文件基础</h2><ol>
<li>文件名：源文件以其最顶层的类名来命名，大小写敏感，文件扩展名为 .java</li>
<li>文件编码：UTF-8</li>
<li>特殊字符：注释明确</li>
</ol>
<h2 id="源文件结构"><a href="#源文件结构" class="headerlink" title="源文件结构"></a>源文件结构</h2><ol>
<li><p>一个源文件包含(按顺序地，以下每个部分之间用一个空行隔开)：</p>
<ul>
<li>许可证或版权信息(如有需要)</li>
<li>package语句：package语句不换行</li>
<li>import语句</li>
<li>一个顶级类(只有一个)</li>
</ul>
</li>
<li><p>import语句</p>
<ul>
<li>import不要使用通配符，即，不要出现类似这样的import语句：<code>import java.util.*;</code></li>
<li>每个import语句独立成行</li>
<li>文件中不能含有无用的import语句</li>
</ul>
</li>
<li><p>类声明</p>
<ul>
<li>只有一个顶级类声明：每个顶级类都在一个与它同名的源文件中</li>
<li>类成员顺序<ul>
<li>成员属性</li>
<li>构造方法</li>
<li>普通方法（按照某中逻辑顺序而非时间顺序）</li>
</ul>
</li>
<li>重载永不分离：当一个类有多个构造函数，或是多个同名方法，这些函数/方法应该按顺序出现在一起，中间不要放进其它函数/方法。</li>
</ul>
</li>
</ol>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><ol>
<li>大括号<ul>
<li>使用大括号(即使是可选的)：大括号与if, else, for, do, while语句一起使用，即使只有一条语句(或是空)，也应该把大括号写上。</li>
<li>非空块：遵循Kernighan和Ritchie风格<ul>
<li>左大括号前不换行</li>
<li>左大括号后换行</li>
<li>右大括号前换行</li>
<li>如果右大括号是一个语句、函数体或类的终止，则右大括号后换行; 否则不换行。例如，如果右大括号后面是else或逗号，则不换行。</li>
</ul>
</li>
<li>空块：一个空的块状结构里什么也不包含，大括号可以简洁地写成{}，不需要换行。例外：如果它是一个多块语句的一部分(if/else 或 try/catch/finally) ，即使大括号内没内容，右大括号也要换行。Eg: void doNothing() {}</li>
</ul>
</li>
<li>缩进：一个Tab为一次缩进</li>
<li>一行一个语句</li>
<li>具体结构<ul>
<li>枚举类：枚举常量间用逗号隔开，换行可选。</li>
<li>变量声明：<ul>
<li>每次只声明一个变量，不要使用组合声明，比如int a, b;。</li>
<li>需要时才声明，并尽快进行初始化：不要在一个代码块的开头把局部变量一次性都声明了(这是c语言的做法)，而是在第一次需要使用它时才声明。</li>
</ul>
</li>
<li>注解(Annotations)：注解紧跟在文档块后面，应用于类、方法和构造函数，一个注解独占一行。单个的注解可以和签名的第一行出现在同一行。应用于字段的多个注解允许与字段出现在同一行。Eg：@Partial @Mock DataLoader loader;</li>
<li>modifiers：类和成员的modifiers如果存在，则按Java语言规范中推荐的顺序出现：<ul>
<li>public protected private abstract static final transient volatile synchronized native strictfp</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><ol>
<li>注释尽可能详细</li>
<li>成员变量和成员方法要有javadoc注释</li>
<li>前台获取的变量最好写上注释</li>
<li>方法中逻辑比较复杂的，应该写相应的业务注释</li>
<li>javadoc注释：统一格式（方法说明、参数、返回值、作者、时间）</li>
</ol>
<h2 id="命名约定"><a href="#命名约定" class="headerlink" title="命名约定"></a>命名约定</h2><ol>
<li>标识符只能使用ASCII字母和数字，并以字母开头。</li>
<li>包名：包名全部小写，连续的单词只是简单地连接起来，不使用下划线。</li>
<li>类名：首字母大写，使用驼峰命名</li>
<li>方法名：首字母小写，使用驼峰命名</li>
<li>常量名：全部字母大写，用下划线分隔单词</li>
</ol>
<h2 id="编程实践"><a href="#编程实践" class="headerlink" title="编程实践"></a>编程实践</h2><ol>
<li>只要是合法的，就把@Override注解给用上。</li>
<li>捕获的异常：不能忽视</li>
<li>静态成员：使用类进行调用</li>
</ol>
<h2 id="代码注释模版"><a href="#代码注释模版" class="headerlink" title="代码注释模版"></a>代码注释模版</h2><p>新增一个xml文件，将以下代码复制进去。Eclipse -&gt; Window -&gt; Preference -&gt; Java -&gt; Code Style -&gt; Code Template –&gt; Import 导入模版文件并保存。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;<span class="tag">&lt;<span class="name">templates</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"typecomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"创建的类型的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.typecomment"</span> <span class="attr">name</span>=<span class="string">"typecomment"</span>&gt;</span>/**</div><div class="line"> * @ClassName: $&#123;type_name&#125;</div><div class="line"> * @Description: $&#123;todo&#125;</div><div class="line"> * @author $&#123;user&#125;</div><div class="line"> * @date $&#123;date&#125; $&#123;time&#125;</div><div class="line"> * $&#123;tags&#125;</div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"filecomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"已创建的 Java 文件的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.filecomment"</span> <span class="attr">name</span>=<span class="string">"filecomment"</span>&gt;</span>/**  </div><div class="line"> * @Title $&#123;file_name&#125;</div><div class="line"> * @Package $&#123;package_name&#125;</div><div class="line"> * @Description $&#123;todo&#125;</div><div class="line"> * @author $&#123;user&#125;</div><div class="line"> * @date $&#123;date&#125; $&#123;time&#125;</div><div class="line"> * @version v1.0</div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"fieldcomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"字段的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.fieldcomment"</span> <span class="attr">name</span>=<span class="string">"fieldcomment"</span>&gt;</span>/**</div><div class="line"> * @Description $&#123;todo&#125;</div><div class="line"> * $&#123;field&#125;</div><div class="line"> */  </div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"settercomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"setter 方法的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.settercomment"</span> <span class="attr">name</span>=<span class="string">"settercomment"</span>&gt;</span>/**    </div><div class="line"> * 设置 $&#123;bare_field_name&#125; 的值    </div><div class="line"> * @param $&#123;param&#125;  </div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"delegatecomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"代表方法的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.delegatecomment"</span> <span class="attr">name</span>=<span class="string">"delegatecomment"</span>&gt;</span>/**</div><div class="line"> * $&#123;tags&#125;</div><div class="line"> * $&#123;see_to_target&#125;</div><div class="line"> */</div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"constructorcomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"创建的构造函数的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.constructorcomment"</span> <span class="attr">name</span>=<span class="string">"constructorcomment"</span>&gt;</span>/**</div><div class="line"> * &amp;lt;p&amp;gt;Title: &amp;lt;/p&amp;gt;</div><div class="line"> * &amp;lt;p&amp;gt;Description: &amp;lt;/p&amp;gt;</div><div class="line"> * $&#123;tags&#125;</div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"methodcomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"非覆盖方法的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.methodcomment"</span> <span class="attr">name</span>=<span class="string">"methodcomment"</span>&gt;</span>/**</div><div class="line"> * @Description $&#123;todo&#125;</div><div class="line"> * $&#123;tags&#125;</div><div class="line"> * @author $&#123;user&#125;</div><div class="line"> * @date $&#123;date&#125; $&#123;time&#125;</div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"gettercomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"getter 方法的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.gettercomment"</span> <span class="attr">name</span>=<span class="string">"gettercomment"</span>&gt;</span>/**</div><div class="line"> * 返回 $&#123;bare_field_name&#125; 的值     </div><div class="line"> * @return $&#123;bare_field_name&#125;</div><div class="line"> */   </div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">autoinsert</span>=<span class="string">"false"</span> <span class="attr">context</span>=<span class="string">"overridecomment_context"</span> <span class="attr">deleted</span>=<span class="string">"false"</span> <span class="attr">description</span>=<span class="string">"覆盖方法的注释"</span> <span class="attr">enabled</span>=<span class="string">"true"</span> <span class="attr">id</span>=<span class="string">"org.eclipse.jdt.ui.text.codetemplates.overridecomment"</span> <span class="attr">name</span>=<span class="string">"overridecomment"</span>&gt;</span>/* (非 Javadoc)</div><div class="line"> * 覆盖方法</div><div class="line"> * &amp;lt;p&amp;gt;Title: $&#123;enclosing_method&#125;&amp;lt;/p&amp;gt;</div><div class="line"> * &amp;lt;p&amp;gt;Description: &amp;lt;/p&amp;gt;</div><div class="line"> * $&#123;tags&#125;</div><div class="line"> * $&#123;see_to_overridden&#125;</div><div class="line"> */<span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">templates</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>参考文章：</p>
<p>[1] <a href="https://github.com/google/styleguide" target="_blank" rel="external">https://github.com/google/styleguide</a></p>
<p>[2] <a href="http://www.hawstein.com/posts/google-java-style.html#Practice" target="_blank" rel="external">http://www.hawstein.com/posts/google-java-style.html#Practice</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"
               alt="Smalle" />
          <p class="site-author-name" itemprop="name">Smalle</p>
           
              <p class="site-description motion-element" itemprop="description">代码，让生活更美化</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">50</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Smalle</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
